!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}((function(e){"use strict";var n={},t=/[^\s\u00a0]/,i=e.Pos,o=e.cmpPos;function l(e){var n=e.search(t);return-1==n?0:n}function r(e, n){var t=e.getMode();return!1!==t.useInnerComments&&t.innerMode?e.getModeAt(n):t}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",(function(e){e||(e=n);for(var t=this,o=1/0,l=this.listSelections(),r=null,a=l.length-1; a>=0; a--){var c=l[a].from(),m=l[a].to();c.line>=o||(m.line>=o&&(m=i(o,0)),o=c.line,null==r?t.uncomment(c,m,e)?r="un":(t.lineComment(c,m,e),r="line"):"un"==r?t.uncomment(c,m,e):t.lineComment(c,m,e))}})),e.defineExtension("lineComment",(function(e, o, a){a||(a=n);var c=this,m=r(c,e),f=c.getLine(e.line);if(null!=f&&(s=e,g=f,!/\bstring\b/.test(c.getTokenTypeAt(i(s.line,0)))||/^[\'\"\`]/.test(g))){var s,g,u=a.lineComment||m.lineComment;if(u){var d=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,c.lastLine()+1),h=null==a.padding?" ":a.padding,p=a.commentBlankLines||e.line==o.line;c.operation((function(){if(a.indent){for(var n=null,o=e.line; o<d; ++o){var r=(m=c.getLine(o)).slice(0,l(m));(null==n||n.length>r.length)&&(n=r)}for(o=e.line; o<d; ++o){var m=c.getLine(o),f=n.length;(p||t.test(m))&&(m.slice(0,f)!=n&&(f=l(m)),c.replaceRange(n+u+h,i(o,0),i(o,f)))}}else for(o=e.line; o<d; ++o)(p||t.test(c.getLine(o)))&&c.replaceRange(u+h,i(o,0))}))}else(a.blockCommentStart||m.blockCommentStart)&&(a.fullLines=!0,c.blockComment(e,o,a))}})),e.defineExtension("blockComment",(function(e, l, a){a||(a=n);var c=this,m=r(c,e),f=a.blockCommentStart||m.blockCommentStart,s=a.blockCommentEnd||m.blockCommentEnd;if(f&&s){if(!/\bcomment\b/.test(c.getTokenTypeAt(i(e.line,0)))){var g=Math.min(l.line,c.lastLine());g!=e.line&&0==l.ch&&t.test(c.getLine(g))&&--g;var u=null==a.padding?" ":a.padding;e.line>g||c.operation((function(){if(0!=a.fullLines){var n=t.test(c.getLine(g));c.replaceRange(u+s,i(g)),c.replaceRange(f+u,i(e.line,0));var r=a.blockCommentLead||m.blockCommentLead;if(null!=r)for(var d=e.line+1; d<=g; ++d)(d!=g||n)&&c.replaceRange(r+u,i(d,0))}else{var h=0==o(c.getCursor("to"),l),p=!c.somethingSelected();c.replaceRange(s,l),h&&c.setSelection(p?l:c.getCursor("from"),l),c.replaceRange(f,e)}}))}}else(a.lineComment||m.lineComment)&&0!=a.fullLines&&c.lineComment(e,l,a)})),e.defineExtension("uncomment",(function(e, o, l){l||(l=n);var a,c=this,m=r(c,e),f=Math.min(0!=o.ch||o.line==e.line?o.line:o.line-1,c.lastLine()),s=Math.min(e.line,f),g=l.lineComment||m.lineComment,u=[],d=null==l.padding?" ":l.padding;e:if(g){for(var h=s; h<=f; ++h){var p=c.getLine(h),C=p.indexOf(g);if(C>-1&&!/comment/.test(c.getTokenTypeAt(i(h,C+1)))&&(C=-1),-1==C&&t.test(p))break e;if(C>-1&&t.test(p.slice(0,C)))break e;u.push(p)}if(c.operation((function(){for(var e=s; e<=f; ++e){var n=u[e-s],t=n.indexOf(g),o=t+g.length;t<0||(n.slice(o,o+d.length)==d&&(o+=d.length),a=!0,c.replaceRange("",i(e,t),i(e,o)))}})),a)return!0}var b=l.blockCommentStart||m.blockCommentStart,v=l.blockCommentEnd||m.blockCommentEnd;if(!b||!v)return!1;var k=l.blockCommentLead||m.blockCommentLead,x=c.getLine(s),L=x.indexOf(b);if(-1==L)return!1;var y=f==s?x:c.getLine(f),O=y.indexOf(v,f==s?L+b.length:0),T=i(s,L+1),S=i(f,O+1);if(-1==O||!/comment/.test(c.getTokenTypeAt(T))||!/comment/.test(c.getTokenTypeAt(S))||c.getRange(T,S,"\n").indexOf(v)>-1)return!1;var M=x.lastIndexOf(b,e.ch),R=-1==M?-1:x.slice(0,e.ch).indexOf(v,M+b.length);if(-1!=M&&-1!=R&&R+v.length!=e.ch)return!1;R=y.indexOf(v,o.ch);var E=y.slice(o.ch).lastIndexOf(b,R-o.ch);return M=-1==R||-1==E?-1:o.ch+E,(-1==R||-1==M||M==o.ch)&&(c.operation((function(){c.replaceRange("",i(f,O-(d&&y.slice(O-d.length,O)==d?d.length:0)),i(f,O+v.length));var e=L+b.length;if(d&&x.slice(e,e+d.length)==d&&(e+=d.length),c.replaceRange("",i(s,L),i(s,e)),k)for(var n=s+1; n<=f; ++n){var o=c.getLine(n),l=o.indexOf(k);if(-1!=l&&!t.test(o.slice(0,l))){var r=l+k.length;d&&o.slice(r,r+d.length)==d&&(r+=d.length),c.replaceRange("",i(n,l),i(n,r))}}})),!0)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}((function(e){var n=/\S/g,t=String.prototype.repeat||function(e){return Array(e+1).join(this)};function i(n){if(n.getOption("disableInput"))return e.Pass;for(var i,r=n.listSelections(),a=[],c=0; c<r.length; c++){var m=r[c].head;if(!/\bcomment\b/.test(n.getTokenTypeAt(m)))return e.Pass;var f=n.getModeAt(m);if(i){if(i!=f)return e.Pass}else i=f;var s,g,u=null,d=i.blockCommentStart,h=i.lineComment;if(d&&i.blockCommentContinue){var p=(s=n.getLine(m.line)).lastIndexOf(i.blockCommentEnd,m.ch-i.blockCommentEnd.length);if(-1!=p&&p==m.ch-i.blockCommentEnd.length||h&&(g=s.lastIndexOf(h,m.ch-1))>-1&&/\bcomment\b/.test(n.getTokenTypeAt({line:m.line,ch:g+1})));else if(m.ch>=d.length&&(g=s.lastIndexOf(d,m.ch-d.length))>-1&&g>p)if(o(0,s)>=g)u=s.slice(0,g);else{var C,b=n.options.tabSize;g=e.countColumn(s,g,b),u=n.options.indentWithTabs?t.call("\t",C=Math.floor(g/b))+t.call(" ",g-b*C):t.call(" ",g)}else(g=s.indexOf(i.blockCommentContinue))>-1&&g<=m.ch&&g<=o(0,s)&&(u=s.slice(0,g));null!=u&&(u+=i.blockCommentContinue)}if(null==u&&h&&l(n))if(null==s&&(s=n.getLine(m.line)),g=s.indexOf(h),m.ch||g){if(g>-1&&o(0,s)>=g){if(!(u=o(m.ch,s)>-1)){var v=n.getLine(m.line+1)||"",k=v.indexOf(h);u=k>-1&&o(0,v)>=k||null}u&&(u=s.slice(0,g)+h+s.slice(g+h.length).match(/^\s*/)[0])}}else u="";if(null==u)return e.Pass;a[c]="\n"+u}n.operation((function(){for(var e=r.length-1; e>=0; e--)n.replaceRange(a[e],r[e].from(),r[e].to(),"+insert")}))}function o(e, t){n.lastIndex=e;var i=n.exec(t);return i?i.index:-1}function l(e){var n=e.getOption("continueComments");return!n||"object"!=typeof n||!1!==n.continueLineComment}e.defineOption("continueComments",null,(function(n, t, o){if(o&&o!=e.Init&&n.removeKeyMap("continueComment"),t){var l="Enter";"string"==typeof t?l=t:"object"==typeof t&&t.key&&(l=t.key);var r={name:"continueComment"};r[l]=i,n.addKeyMap(r)}}))}));