!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror")):"function"==typeof define&&define.amd?define(["../codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t=e.commands,r=e.Pos;function n(e, t){return e.line==t.line&&e.ch==t.ch}var o=[];function i(e){o.push(e),o.length>50&&o.shift()}function a(e){return o[o.length-(e?Math.min(e,1):1)]||""}var s=null;function l(e, t, r, a, l){null==l&&(l=e.getRange(t,r)),"grow"==a&&s&&s.cm==e&&n(t,s.pos)&&e.isClean(s.gen)?function(e){if(!o.length)return i(e);o[o.length-1]+=e}(l):!1!==a&&i(l),e.replaceRange("",t,r,"+delete"),s="grow"==a?{cm:e,pos:t,gen:e.changeGeneration()}:null}function c(e, t, r){return e.findPosH(t,r,"char",!0)}function u(e, t, r){return e.findPosH(t,r,"word",!0)}function f(e, t, r){return e.findPosV(t,r,"line",e.doc.sel.goalColumn)}function d(e, t, r){return e.findPosV(t,r,"page",e.doc.sel.goalColumn)}function h(e, t, n){for(var o=t.line,i=e.getLine(o),a=/\S/.test(n<0?i.slice(0,t.ch):i.slice(t.ch)),s=e.firstLine(),l=e.lastLine();;){if((o+=n)<s||o>l)return e.clipPos(r(o-n,n<0?0:null));if(i=e.getLine(o),/\S/.test(i))a=!0;else if(a)return r(o,0)}}function p(e, t, n){for(var o=t.line,i=t.ch,a=e.getLine(t.line),s=!1;;){var l=a.charAt(i+(n<0?-1:0));if(l){if(s&&/[!?.]/.test(l))return r(o,i+(n>0?1:0));s||(s=/\w/.test(l)),i+=n}else{if(o==(n<0?e.firstLine():e.lastLine()))return r(o,i);if(a=e.getLine(o+n),!/\S/.test(a))return r(o,i);o+=n,i=n<0?a.length:0}}}function m(e, t, o){var i;if(e.findMatchingBracket&&(i=e.findMatchingBracket(t,{strict:!0}))&&i.match&&(i.forward?1:-1)==o)return o>0?r(i.to.line,i.to.ch+1):i.to;for(var a=!0;; a=!1){var s=e.getTokenAt(t),l=r(t.line,o<0?s.start:s.end);if(!(a&&o>0&&s.end==t.ch)&&/\w/.test(s.string))return l;var c=e.findPosH(l,o,"char");if(n(l,c))return t;t=c}}function g(e, t){var r=e.state.emacsPrefix;return r?(L(e),"-"==r?-1:Number(r)):t?null:1}function v(e){var t="string"==typeof e?function(t){t.execCommand(e)}:e;return function(e){var r=g(e);t(e);for(var n=1; n<r; ++n)t(e)}}function y(e, t, r, o){var i=g(e);i<0&&(o=-o,i=-i);for(var a=0; a<i; ++a){var s=r(e,t,o);if(n(s,t))break;t=s}return t}function C(e, t){var r=function(r){r.extendSelection(y(r,r.getCursor(),e,t))};return r.motion=!0,r}function k(e, t, r, n){for(var o,i=e.listSelections(),a=i.length; a--;)l(e,o=i[a].head,y(e,o,t,r),n)}function w(e, t){if(e.somethingSelected()){for(var r,n=e.listSelections(),o=n.length; o--;)l(e,(r=n[o]).anchor,r.head,t);return!0}}function S(e, t){e.state.emacsPrefix?"-"!=t&&(e.state.emacsPrefix+=t):(e.state.emacsPrefix=t,e.on("keyHandled",A),e.on("inputRead",b))}var x={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0};function A(e, t){e.state.emacsPrefixMap||x.hasOwnProperty(t)||L(e)}function L(e){e.state.emacsPrefix=null,e.off("keyHandled",A),e.off("inputRead",b)}function b(e, t){var r=g(e);if(r>1&&"+input"==t.origin){for(var n=t.text.join("\n"),o="",i=1; i<r; ++i)o+=n;e.replaceSelection(o)}}function M(e, t){("string"!=typeof t||!/^\d$/.test(t)&&"Ctrl-U"!=t)&&(e.removeKeyMap(I),e.state.emacsPrefixMap=!1,e.off("keyHandled",M),e.off("inputRead",M))}function R(e){e.setExtending(!1),e.setCursor(e.getCursor())}function T(e, t, r){e.openDialog?e.openDialog(function(e){var t=document.createDocumentFragment(),r=document.createElement("input");return r.setAttribute("type","text"),r.style.width="10em",t.appendChild(document.createTextNode(e+": ")),t.appendChild(r),t}(t),r,{bottom:!0}):r(prompt(t,""))}function B(e, t){var r=e.getCursor(),n=e.findPosH(r,1,"word");e.replaceRange(t(e.getRange(r,n)),r,n),e.setCursor(n)}t.setMark=function(e){e.setCursor(e.getCursor()),e.setExtending(!e.getExtending()),e.on("change",function(){e.setExtending(!1)})},t.killRegion=function(e){l(e,e.getCursor("start"),e.getCursor("end"),!0)},t.killLineEmacs=v(function(e){var t=e.getCursor(),n=e.clipPos(r(t.line)),o=e.getRange(t,n);/\S/.test(o)||(o+="\n",n=r(t.line+1,0)),l(e,t,n,"grow",o)}),t.killRingSave=function(e){i(e.getSelection()),R(e)},t.yank=function(e){var t=e.getCursor();e.replaceRange(a(g(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},t.yankPop=function(e){e.replaceSelection((o.length>1&&o.pop(),a()),"around","paste")},t.forwardChar=C(c,1),t.backwardChar=C(c,-1),t.deleteChar=function(e){k(e,c,1,!1)},t.deleteForwardChar=function(e){w(e,!1)||k(e,c,1,!1)},t.deleteBackwardChar=function(e){w(e,!1)||k(e,c,-1,!1)},t.forwardWord=C(u,1),t.backwardWord=C(u,-1),t.killWord=function(e){k(e,u,1,"grow")},t.backwardKillWord=function(e){k(e,u,-1,"grow")},t.nextLine=C(f,1),t.previousLine=C(f,-1),t.scrollDownCommand=C(d,-1),t.scrollUpCommand=C(d,1),t.backwardParagraph=C(h,-1),t.forwardParagraph=C(h,1),t.backwardSentence=C(p,-1),t.forwardSentence=C(p,1),t.killSentence=function(e){k(e,p,1,"grow")},t.backwardKillSentence=function(e){l(e,e.getCursor(),p(e,e.getCursor(),1),"grow")},t.killSexp=function(e){k(e,m,1,"grow")},t.backwardKillSexp=function(e){k(e,m,-1,"grow")},t.forwardSexp=C(m,1),t.backwardSexp=C(m,-1),t.markSexp=function(e){var t=e.getCursor();e.setSelection(y(e,t,m,1),t)},t.transposeSexps=function(e){var t=m(e,e.getCursor(),-1),r=m(e,t,1),n=m(e,r,1),o=m(e,n,-1);e.replaceRange(e.getRange(o,n)+e.getRange(r,o)+e.getRange(t,r),t,n)},t.backwardUpList=v(function(e){for(var t=e.getCursor(),n=t.line,o=t.ch,i=[]; n>=e.firstLine();){for(var a=e.getLine(n),s=null==o?a.length:o; s>0;)if(")"==(o=a.charAt(--s)))i.push("(");else if("]"==o)i.push("[");else if("}"==o)i.push("{");else if(/[\(\{\[]/.test(o)&&(!i.length||i.pop()!=o))return e.extendSelection(r(n,s));--n,o=null}}),t.justOneSpace=function(e){for(var t=e.getCursor(),n=t.ch,o=t.ch,i=e.getLine(t.line); n&&/\s/.test(i.charAt(n-1));)--n;for(; o<i.length&&/\s/.test(i.charAt(o));)++o;e.replaceRange(" ",r(t.line,n),r(t.line,o))},t.openLine=v(function(e){e.replaceSelection("\n","start")}),t.transposeCharsRepeatable=v(function(e){e.execCommand("transposeChars")}),t.capitalizeWord=v(function(e){B(e,function(e){var t=e.search(/\w/);return-1==t?e:e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()})}),t.upcaseWord=v(function(e){B(e,function(e){return e.toUpperCase()})}),t.downcaseWord=v(function(e){B(e,function(e){return e.toLowerCase()})}),t.undoRepeatable=v("undo"),t.keyboardQuit=function(e){e.execCommand("clearSearch"),R(e)},t.newline=v(function(e){e.replaceSelection("\n","end")}),t.gotoLine=function(e){var t=g(e,!0);if(null!=t&&t>0)return e.setCursor(t-1);T(e,"Goto line",function(t){var r;t&&!isNaN(r=Number(t))&&r==(0|r)&&r>0&&e.setCursor(r-1)})},t.indentRigidly=function(e){e.indentSelection(g(e,!0)||e.getOption("indentUnit"))},t.exchangePointAndMark=function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},t.quotedInsertTab=v("insertTab"),t.universalArgument=function(e){e.state.emacsPrefixMap=!0,e.addKeyMap(I),e.on("keyHandled",M),e.on("inputRead",M)},e.emacs={kill:l,killRegion:w,repeated:v};var E=e.keyMap.emacs=e.normalizeKeyMap({"Ctrl-W":"killRegion","Ctrl-K":"killLineEmacs","Alt-W":"killRingSave","Ctrl-Y":"yank","Alt-Y":"yankPop","Ctrl-Space":"setMark","Ctrl-Shift-2":"setMark","Ctrl-F":"forwardChar","Ctrl-B":"backwardChar",Right:"forwardChar",Left:"backwardChar","Ctrl-D":"deleteChar",Delete:"deleteForwardChar","Ctrl-H":"deleteBackwardChar",Backspace:"deleteBackwardChar","Alt-F":"forwardWord","Alt-B":"backwardWord","Alt-Right":"forwardWord","Alt-Left":"backwardWord","Alt-D":"killWord","Alt-Backspace":"backwardKillWord","Ctrl-N":"nextLine","Ctrl-P":"previousLine",Down:"nextLine",Up:"previousLine","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":"scrollDownCommand","Ctrl-V":"scrollUpCommand",PageUp:"scrollDownCommand",PageDown:"scrollUpCommand","Ctrl-Up":"backwardParagraph","Ctrl-Down":"forwardParagraph","Alt-{":"backwardParagraph","Alt-}":"forwardParagraph","Alt-A":"backwardSentence","Alt-E":"forwardSentence","Alt-K":"killSentence","Ctrl-X Delete":"backwardKillSentence","Ctrl-Alt-K":"killSexp","Ctrl-Alt-Backspace":"backwardKillSexp","Ctrl-Alt-F":"forwardSexp","Ctrl-Alt-B":"backwardSexp","Shift-Ctrl-Alt-2":"markSexp","Ctrl-Alt-T":"transposeSexps","Ctrl-Alt-U":"backwardUpList","Alt-Space":"justOneSpace","Ctrl-O":"openLine","Ctrl-T":"transposeCharsRepeatable","Alt-C":"capitalizeWord","Alt-U":"upcaseWord","Alt-L":"downcaseWord","Alt-;":"toggleComment","Ctrl-/":"undoRepeatable","Shift-Ctrl--":"undoRepeatable","Ctrl-Z":"undoRepeatable","Cmd-Z":"undoRepeatable","Ctrl-X U":"undoRepeatable","Shift-Ctrl-Z":"redo","Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":"keyboardQuit","Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":"newline",Tab:"indentAuto","Alt-G G":"gotoLine","Ctrl-X Tab":"indentRigidly","Ctrl-X Ctrl-X":"exchangePointAndMark","Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X K":"close","Ctrl-X H":"selectAll","Ctrl-Q Tab":"quotedInsertTab","Ctrl-U":"universalArgument",fallthrough:"default"}),I={"Ctrl-G":L};function O(e){I[e]=function(t){S(t,e)},E["Ctrl-"+e]=function(t){S(t,e)},x["Ctrl-"+e]=!0}for(var P=0; P<10; ++P)O(String(P));O("-")}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror"),require("../addon/search/searchcursor"),require("../addon/edit/matchbrackets")):"function"==typeof define&&define.amd?define(["../codemirror","../addon/search/searchcursor","../addon/edit/matchbrackets"],e):e(CodeMirror)}(function(e){"use strict";var t=e.commands,r=e.Pos;function n(t, n){t.extendSelectionsBy(function(o){return t.display.shift||t.doc.extend||o.empty()?function(t, n, o){if(o<0&&0==n.ch)return t.clipPos(r(n.line-1));var i=t.getLine(n.line);if(o>0&&n.ch>=i.length)return t.clipPos(r(n.line+1,0));for(var a,s="start",l=n.ch,c=l,u=o<0?0:i.length,f=0; c!=u; c+=o,f++){var d=i.charAt(o<0?c-1:c),h="_"!=d&&e.isWordChar(d)?"w":"o";if("w"==h&&d.toUpperCase()==d&&(h="W"),"start"==s)"o"!=h?(s="in",a=h):l=c+o;else if("in"==s&&a!=h){if("w"==a&&"W"==h&&o<0&&c--,"W"==a&&"w"==h&&o>0){if(c==l+1){a="w";continue}c--}break}}return r(n.line,c)}(t.doc,o.head,n):n<0?o.from():o.to()})}function o(t, n){if(t.isReadOnly())return e.Pass;t.operation(function(){for(var e=t.listSelections().length,o=[],i=-1,a=0; a<e; a++){var s=t.listSelections()[a].head;if(!(s.line<=i)){var l=r(s.line+(n?0:1),0);t.replaceRange("\n",l,null,"+insertLine"),t.indentLine(l.line,null,!0),o.push({head:l,anchor:l}),i=s.line+1}}t.setSelections(o)}),t.execCommand("indentAuto")}function i(t, n){for(var o=n.ch,i=o,a=t.getLine(n.line); o&&e.isWordChar(a.charAt(o-1));)--o;for(; i<a.length&&e.isWordChar(a.charAt(i));)++i;return{from:r(n.line,o),to:r(n.line,i),word:a.slice(o,i)}}function a(e, t){for(var r=e.listSelections(),n=[],o=0; o<r.length; o++){var i=r[o],a=e.findPosV(i.anchor,t,"line",i.anchor.goalColumn),s=e.findPosV(i.head,t,"line",i.head.goalColumn);a.goalColumn=null!=i.anchor.goalColumn?i.anchor.goalColumn:e.cursorCoords(i.anchor,"div").left,s.goalColumn=null!=i.head.goalColumn?i.head.goalColumn:e.cursorCoords(i.head,"div").left;var l={anchor:a,head:s};n.push(i),n.push(l)}e.setSelections(n)}t.goSubwordLeft=function(e){n(e,-1)},t.goSubwordRight=function(e){n(e,1)},t.scrollLineUp=function(e){var t=e.getScrollInfo();if(!e.somethingSelected()){var r=e.lineAtHeight(t.top+t.clientHeight,"local");e.getCursor().line>=r&&e.execCommand("goLineUp")}e.scrollTo(null,t.top-e.defaultTextHeight())},t.scrollLineDown=function(e){var t=e.getScrollInfo();if(!e.somethingSelected()){var r=e.lineAtHeight(t.top,"local")+1;e.getCursor().line<=r&&e.execCommand("goLineDown")}e.scrollTo(null,t.top+e.defaultTextHeight())},t.splitSelectionByLine=function(e){for(var t=e.listSelections(),n=[],o=0; o<t.length; o++)for(var i=t[o].from(),a=t[o].to(),s=i.line; s<=a.line; ++s)a.line>i.line&&s==a.line&&0==a.ch||n.push({anchor:s==i.line?i:r(s,0),head:s==a.line?a:r(s)});e.setSelections(n,0)},t.singleSelectionTop=function(e){var t=e.listSelections()[0];e.setSelection(t.anchor,t.head,{scroll:!1})},t.selectLine=function(e){for(var t=e.listSelections(),n=[],o=0; o<t.length; o++){var i=t[o];n.push({anchor:r(i.from().line,0),head:r(i.to().line+1,0)})}e.setSelections(n)},t.insertLineAfter=function(e){return o(e,!1)},t.insertLineBefore=function(e){return o(e,!0)},t.selectNextOccurrence=function(t){var n=t.getCursor("from"),o=t.getCursor("to"),a=t.state.sublimeFindFullWord==t.doc.sel;if(0==e.cmpPos(n,o)){var s=i(t,n);if(!s.word)return;t.setSelection(s.from,s.to),a=!0}else{var l=t.getRange(n,o),c=a?new RegExp("\\b"+l+"\\b"):l,u=t.getSearchCursor(c,o),f=u.findNext();if(f||(f=(u=t.getSearchCursor(c,r(t.firstLine(),0))).findNext()),!f||function(t, r, n){for(var o=0; o<t.length; o++)if(0==e.cmpPos(t[o].from(),r)&&0==e.cmpPos(t[o].to(),n))return!0;return!1}(t.listSelections(),u.from(),u.to()))return;t.addSelection(u.from(),u.to())}a&&(t.state.sublimeFindFullWord=t.doc.sel)},t.skipAndSelectNextOccurrence=function(r){var n=r.getCursor("anchor"),o=r.getCursor("head");t.selectNextOccurrence(r),0!=e.cmpPos(n,o)&&r.doc.setSelections(r.doc.listSelections().filter(function(e){return e.anchor!=n||e.head!=o}))},t.addCursorToPrevLine=function(e){a(e,-1)},t.addCursorToNextLine=function(e){a(e,1)};var s="(){}[]";function l(t){for(var n=t.listSelections(),o=[],i=0; i<n.length; i++){var a=n[i],l=a.head,c=t.scanForBracket(l,-1);if(!c)return!1;for(;;){var u=t.scanForBracket(l,1);if(!u)return!1;if(u.ch==s.charAt(s.indexOf(c.ch)+1)){var f=r(c.pos.line,c.pos.ch+1);if(0!=e.cmpPos(f,a.from())||0!=e.cmpPos(u.pos,a.to())){o.push({anchor:f,head:u.pos});break}if(!(c=t.scanForBracket(c.pos,-1)))return!1}l=r(u.pos.line,u.pos.ch+1)}}return t.setSelections(o),!0}function c(e){return e?/\bpunctuation\b/.test(e)?e:void 0:null}function u(t, n, o){if(t.isReadOnly())return e.Pass;for(var i,a=t.listSelections(),s=[],l=0; l<a.length; l++){var c=a[l];if(!c.empty()){for(var u=c.from().line,f=c.to().line; l<a.length-1&&a[l+1].from().line==f;)f=a[++l].to().line;a[l].to().ch||f--,s.push(u,f)}}s.length?i=!0:s.push(t.firstLine(),t.lastLine()),t.operation(function(){for(var e=[],a=0; a<s.length; a+=2){var l=s[a],c=s[a+1],u=r(l,0),f=r(c),d=t.getRange(u,f,!1);n?d.sort(function(e, t){return e<t?-o:e==t?0:o}):d.sort(function(e, t){var r=e.toUpperCase(),n=t.toUpperCase();return r!=n&&(e=r,t=n),e<t?-o:e==t?0:o}),t.replaceRange(d,u,f),i&&e.push({anchor:u,head:r(c+1,0)})}i&&t.setSelections(e,0)})}function f(t, r){t.operation(function(){for(var n=t.listSelections(),o=[],a=[],s=0; s<n.length; s++){(c=n[s]).empty()?(o.push(s),a.push("")):a.push(r(t.getRange(c.from(),c.to())))}t.replaceSelections(a,"around","case");var l;for(s=o.length-1; s>=0; s--){var c=n[o[s]];if(!(l&&e.cmpPos(c.head,l)>0)){var u=i(t,c.head);l=u.from,t.replaceRange(r(u.word),u.from,u.to)}}})}function d(t){var r=t.getCursor("from"),n=t.getCursor("to");if(0==e.cmpPos(r,n)){var o=i(t,r);if(!o.word)return;r=o.from,n=o.to}return{from:r,to:n,query:t.getRange(r,n),word:o}}function h(e, t){var n=d(e);if(n){var o=n.query,i=e.getSearchCursor(o,t?n.to:n.from);(t?i.findNext():i.findPrevious())?e.setSelection(i.from(),i.to()):(i=e.getSearchCursor(o,t?r(e.firstLine(),0):e.clipPos(r(e.lastLine()))),(t?i.findNext():i.findPrevious())?e.setSelection(i.from(),i.to()):n.word&&e.setSelection(n.from,n.to))}}t.selectScope=function(e){l(e)||e.execCommand("selectAll")},t.selectBetweenBrackets=function(t){if(!l(t))return e.Pass},t.goToBracket=function(t){t.extendSelectionsBy(function(n){var o=t.scanForBracket(n.head,1,c(t.getTokenTypeAt(n.head)));if(o&&0!=e.cmpPos(o.pos,n.head))return o.pos;var i=t.scanForBracket(n.head,-1,c(t.getTokenTypeAt(r(n.head.line,n.head.ch+1))));return i&&r(i.pos.line,i.pos.ch+1)||n.head})},t.swapLineUp=function(t){if(t.isReadOnly())return e.Pass;for(var n=t.listSelections(),o=[],i=t.firstLine()-1,a=[],s=0; s<n.length; s++){var l=n[s],c=l.from().line-1,u=l.to().line;a.push({anchor:r(l.anchor.line-1,l.anchor.ch),head:r(l.head.line-1,l.head.ch)}),0!=l.to().ch||l.empty()||--u,c>i?o.push(c,u):o.length&&(o[o.length-1]=u),i=u}t.operation(function(){for(var e=0; e<o.length; e+=2){var n=o[e],i=o[e+1],s=t.getLine(n);t.replaceRange("",r(n,0),r(n+1,0),"+swapLine"),i>t.lastLine()?t.replaceRange("\n"+s,r(t.lastLine()),null,"+swapLine"):t.replaceRange(s+"\n",r(i,0),null,"+swapLine")}t.setSelections(a),t.scrollIntoView()})},t.swapLineDown=function(t){if(t.isReadOnly())return e.Pass;for(var n=t.listSelections(),o=[],i=t.lastLine()+1,a=n.length-1; a>=0; a--){var s=n[a],l=s.to().line+1,c=s.from().line;0!=s.to().ch||s.empty()||l--,l<i?o.push(l,c):o.length&&(o[o.length-1]=c),i=c}t.operation(function(){for(var e=o.length-2; e>=0; e-=2){var n=o[e],i=o[e+1],a=t.getLine(n);n==t.lastLine()?t.replaceRange("",r(n-1),r(n),"+swapLine"):t.replaceRange("",r(n,0),r(n+1,0),"+swapLine"),t.replaceRange(a+"\n",r(i,0),null,"+swapLine")}t.scrollIntoView()})},t.toggleCommentIndented=function(e){e.toggleComment({indent:!0})},t.joinLines=function(e){for(var t=e.listSelections(),n=[],o=0; o<t.length; o++){for(var i=t[o],a=i.from(),s=a.line,l=i.to().line; o<t.length-1&&t[o+1].from().line==l;)l=t[++o].to().line;n.push({start:s,end:l,anchor:!i.empty()&&a})}e.operation(function(){for(var t=0,o=[],i=0; i<n.length; i++){for(var a,s=n[i],l=s.anchor&&r(s.anchor.line-t,s.anchor.ch),c=s.start; c<=s.end; c++){var u=c-t;c==s.end&&(a=r(u,e.getLine(u).length+1)),u<e.lastLine()&&(e.replaceRange(" ",r(u),r(u+1,/^\s*/.exec(e.getLine(u+1))[0].length)),++t)}o.push({anchor:l||a,head:a})}e.setSelections(o,0)})},t.duplicateLine=function(e){e.operation(function(){for(var t=e.listSelections().length,n=0; n<t; n++){var o=e.listSelections()[n];o.empty()?e.replaceRange(e.getLine(o.head.line)+"\n",r(o.head.line,0)):e.replaceRange(e.getRange(o.from(),o.to()),o.from())}e.scrollIntoView()})},t.sortLines=function(e){u(e,!0,1)},t.reverseSortLines=function(e){u(e,!0,-1)},t.sortLinesInsensitive=function(e){u(e,!1,1)},t.reverseSortLinesInsensitive=function(e){u(e,!1,-1)},t.nextBookmark=function(e){var t=e.state.sublimeBookmarks;if(t)for(; t.length;){var r=t.shift(),n=r.find();if(n)return t.push(r),e.setSelection(n.from,n.to)}},t.prevBookmark=function(e){var t=e.state.sublimeBookmarks;if(t)for(; t.length;){t.unshift(t.pop());var r=t[t.length-1].find();if(r)return e.setSelection(r.from,r.to);t.pop()}},t.toggleBookmark=function(e){for(var t=e.listSelections(),r=e.state.sublimeBookmarks||(e.state.sublimeBookmarks=[]),n=0; n<t.length; n++){for(var o=t[n].from(),i=t[n].to(),a=t[n].empty()?e.findMarksAt(o):e.findMarks(o,i),s=0; s<a.length; s++)if(a[s].sublimeBookmark){a[s].clear();for(var l=0; l<r.length; l++)r[l]==a[s]&&r.splice(l--,1);break}s==a.length&&r.push(e.markText(o,i,{sublimeBookmark:!0,clearWhenEmpty:!1}))}},t.clearBookmarks=function(e){var t=e.state.sublimeBookmarks;if(t)for(var r=0; r<t.length; r++)t[r].clear();t.length=0},t.selectBookmarks=function(e){var t=e.state.sublimeBookmarks,r=[];if(t)for(var n=0; n<t.length; n++){var o=t[n].find();o?r.push({anchor:o.from,head:o.to}):t.splice(n--,0)}r.length&&e.setSelections(r,0)},t.smartBackspace=function(t){if(t.somethingSelected())return e.Pass;t.operation(function(){for(var n=t.listSelections(),o=t.getOption("indentUnit"),i=n.length-1; i>=0; i--){var a=n[i].head,s=t.getRange({line:a.line,ch:0},a),l=e.countColumn(s,null,t.getOption("tabSize")),c=t.findPosH(a,-1,"char",!1);if(s&&!/\S/.test(s)&&l%o==0){var u=new r(a.line,e.findColumn(s,l-o,o));u.ch!=a.ch&&(c=u)}t.replaceRange("",c,a,"+delete")}})},t.delLineRight=function(e){e.operation(function(){for(var t=e.listSelections(),n=t.length-1; n>=0; n--)e.replaceRange("",t[n].anchor,r(t[n].to().line),"+delete");e.scrollIntoView()})},t.upcaseAtCursor=function(e){f(e,function(e){return e.toUpperCase()})},t.downcaseAtCursor=function(e){f(e,function(e){return e.toLowerCase()})},t.setSublimeMark=function(e){e.state.sublimeMark&&e.state.sublimeMark.clear(),e.state.sublimeMark=e.setBookmark(e.getCursor())},t.selectToSublimeMark=function(e){var t=e.state.sublimeMark&&e.state.sublimeMark.find();t&&e.setSelection(e.getCursor(),t)},t.deleteToSublimeMark=function(t){var r=t.state.sublimeMark&&t.state.sublimeMark.find();if(r){var n=t.getCursor(),o=r;if(e.cmpPos(n,o)>0){var i=o;o=n,n=i}t.state.sublimeKilled=t.getRange(n,o),t.replaceRange("",n,o)}},t.swapWithSublimeMark=function(e){var t=e.state.sublimeMark&&e.state.sublimeMark.find();t&&(e.state.sublimeMark.clear(),e.state.sublimeMark=e.setBookmark(e.getCursor()),e.setCursor(t))},t.sublimeYank=function(e){null!=e.state.sublimeKilled&&e.replaceSelection(e.state.sublimeKilled,null,"paste")},t.showInCenter=function(e){var t=e.cursorCoords(null,"local");e.scrollTo(null,(t.top+t.bottom)/2-e.getScrollInfo().clientHeight/2)},t.findUnder=function(e){h(e,!0)},t.findUnderPrevious=function(e){h(e,!1)},t.findAllUnder=function(e){var t=d(e);if(t){for(var r=e.getSearchCursor(t.query),n=[],o=-1; r.findNext();)n.push({anchor:r.from(),head:r.to()}),r.from().line<=t.from.line&&r.from().ch<=t.from.ch&&o++;e.setSelections(n,o)}};var p=e.keyMap;p.macSublime={"Cmd-Left":"goLineStartSmart","Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-Left":"goSubwordLeft","Ctrl-Right":"goSubwordRight","Ctrl-Alt-Up":"scrollLineUp","Ctrl-Alt-Down":"scrollLineDown","Cmd-L":"selectLine","Shift-Cmd-L":"splitSelectionByLine",Esc:"singleSelectionTop","Cmd-Enter":"insertLineAfter","Shift-Cmd-Enter":"insertLineBefore","Cmd-D":"selectNextOccurrence","Shift-Cmd-Space":"selectScope","Shift-Cmd-M":"selectBetweenBrackets","Cmd-M":"goToBracket","Cmd-Ctrl-Up":"swapLineUp","Cmd-Ctrl-Down":"swapLineDown","Cmd-/":"toggleCommentIndented","Cmd-J":"joinLines","Shift-Cmd-D":"duplicateLine",F5:"sortLines","Shift-F5":"reverseSortLines","Cmd-F5":"sortLinesInsensitive","Shift-Cmd-F5":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Cmd-F2":"toggleBookmark","Shift-Cmd-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Cmd-K Cmd-D":"skipAndSelectNextOccurrence","Cmd-K Cmd-K":"delLineRight","Cmd-K Cmd-U":"upcaseAtCursor","Cmd-K Cmd-L":"downcaseAtCursor","Cmd-K Cmd-Space":"setSublimeMark","Cmd-K Cmd-A":"selectToSublimeMark","Cmd-K Cmd-W":"deleteToSublimeMark","Cmd-K Cmd-X":"swapWithSublimeMark","Cmd-K Cmd-Y":"sublimeYank","Cmd-K Cmd-C":"showInCenter","Cmd-K Cmd-G":"clearBookmarks","Cmd-K Cmd-Backspace":"delLineLeft","Cmd-K Cmd-1":"foldAll","Cmd-K Cmd-0":"unfoldAll","Cmd-K Cmd-J":"unfoldAll","Ctrl-Shift-Up":"addCursorToPrevLine","Ctrl-Shift-Down":"addCursorToNextLine","Cmd-F3":"findUnder","Shift-Cmd-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Cmd-[":"fold","Shift-Cmd-]":"unfold","Cmd-I":"findIncremental","Shift-Cmd-I":"findIncrementalReverse","Cmd-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"macDefault"},e.normalizeKeyMap(p.macSublime),p.pcSublime={"Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-T":"transposeChars","Alt-Left":"goSubwordLeft","Alt-Right":"goSubwordRight","Ctrl-Up":"scrollLineUp","Ctrl-Down":"scrollLineDown","Ctrl-L":"selectLine","Shift-Ctrl-L":"splitSelectionByLine",Esc:"singleSelectionTop","Ctrl-Enter":"insertLineAfter","Shift-Ctrl-Enter":"insertLineBefore","Ctrl-D":"selectNextOccurrence","Shift-Ctrl-Space":"selectScope","Shift-Ctrl-M":"selectBetweenBrackets","Ctrl-M":"goToBracket","Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown","Ctrl-/":"toggleCommentIndented","Ctrl-J":"joinLines","Shift-Ctrl-D":"duplicateLine",F9:"sortLines","Shift-F9":"reverseSortLines","Ctrl-F9":"sortLinesInsensitive","Shift-Ctrl-F9":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Ctrl-F2":"toggleBookmark","Shift-Ctrl-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Ctrl-K Ctrl-D":"skipAndSelectNextOccurrence","Ctrl-K Ctrl-K":"delLineRight","Ctrl-K Ctrl-U":"upcaseAtCursor","Ctrl-K Ctrl-L":"downcaseAtCursor","Ctrl-K Ctrl-Space":"setSublimeMark","Ctrl-K Ctrl-A":"selectToSublimeMark","Ctrl-K Ctrl-W":"deleteToSublimeMark","Ctrl-K Ctrl-X":"swapWithSublimeMark","Ctrl-K Ctrl-Y":"sublimeYank","Ctrl-K Ctrl-C":"showInCenter","Ctrl-K Ctrl-G":"clearBookmarks","Ctrl-K Ctrl-Backspace":"delLineLeft","Ctrl-K Ctrl-1":"foldAll","Ctrl-K Ctrl-0":"unfoldAll","Ctrl-K Ctrl-J":"unfoldAll","Ctrl-Alt-Up":"addCursorToPrevLine","Ctrl-Alt-Down":"addCursorToNextLine","Ctrl-F3":"findUnder","Shift-Ctrl-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Ctrl-[":"fold","Shift-Ctrl-]":"unfold","Ctrl-I":"findIncremental","Shift-Ctrl-I":"findIncrementalReverse","Ctrl-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"pcDefault"},e.normalizeKeyMap(p.pcSublime);var m=p.default==p.macDefault;p.sublime=m?p.macSublime:p.pcSublime}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog"),require("../addon/edit/matchbrackets.js")):"function"==typeof define&&define.amd?define(["../codemirror","../addon/search/searchcursor","../addon/dialog","../addon/edit/matchbrackets"],e):e(CodeMirror)}(function(e){"use strict";var t=e.Pos;function r(e, r){var n=e.state.vim;if(!n||n.insertMode)return r.head;var o=n.sel.head;return o?n.visualBlock&&r.head.line!=o.line?void 0:r.from()!=r.anchor||r.empty()||r.head.line!=o.line||r.head.ch==o.ch?r.head:new t(r.head.line,r.head.ch-1):r.head}var n=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],o=n.length,i=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}];e.Vim=function(){function a(t, r){this==e.keyMap.vim&&(t.options.$customCursor=null,e.rmClass(t.getWrapperElement(),"cm-fat-cursor")),r&&r.attach==s||function(t){t.setOption("disableInput",!1),t.off("cursorActivity",Ze),e.off(t.getInputField(),"paste",f(t)),t.state.vim=null,Ue&&clearTimeout(Ue)}(t)}function s(t, n){this==e.keyMap.vim&&(t.curOp&&(t.curOp.selectionChanged=!0),t.options.$customCursor=r,e.addClass(t.getWrapperElement(),"cm-fat-cursor")),n&&n.attach==s||function(t){t.setOption("disableInput",!0),t.setOption("showCursorWhenSelecting",!1),e.signal(t,"vim-mode-change",{mode:"normal"}),t.on("cursorActivity",Ze),F(t),e.on(t.getInputField(),"paste",f(t))}(t)}function l(t, r){if(r){if(this[t])return this[t];var n=function(e){if("'"==e.charAt(0))return e.charAt(1);var t=e.split(/-(?!$)/),r=t[t.length-1];if(1==t.length&&1==t[0].length)return!1;if(2==t.length&&"Shift"==t[0]&&1==r.length)return!1;for(var n=!1,o=0; o<t.length; o++){var i=t[o];i in c?t[o]=c[i]:n=!0,i in u&&(t[o]=u[i])}return!!n&&(A(r)&&(t[t.length-1]=r.toLowerCase()),"<"+t.join("-")+">")}(t);if(!n)return!1;var o=U.findKey(r,n);return"function"==typeof o&&e.signal(r,"vim-keypress",n),o}}e.defineOption("vimMode",!1,function(t, r, n){r&&"vim"!=t.getOption("keyMap")?t.setOption("keyMap","vim"):!r&&n!=e.Init&&/^vim/.test(t.getOption("keyMap"))&&t.setOption("keyMap","default")});var c={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},u={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function f(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(Y(e.getCursor(),0,1)),z.enterInsertMode(e,{},t))}),t.onPasteFn}var d=/[\d]/,h=[e.isWordChar,function(t){return t&&!e.isWordChar(t)&&!/\s/.test(t)}],p=[function(e){return/\S/.test(e)}];function m(e, t){for(var r=[],n=e; n<e+t; n++)r.push(String.fromCharCode(n));return r}var g,v=m(65,26),y=m(97,26),C=m(48,10),k=[].concat(v,y,C,["<",">"]),w=[].concat(v,y,C,["-",'"',".",":","_","/"]);try{g=new RegExp("^[\\p{Lu}]$","u")}catch(e){g=/^[A-Z]$/}function S(e, t){return t>=e.firstLine()&&t<=e.lastLine()}function x(e){return/^[a-z]$/.test(e)}function A(e){return g.test(e)}function L(e){return/^\s*$/.test(e)}function b(e){return-1!=".?!".indexOf(e)}function M(e, t){for(var r=0; r<t.length; r++)if(t[r]==e)return!0;return!1}var R={};function T(e, t, r, n, o){if(void 0===t&&!o)throw Error("defaultValue is required unless callback is provided");if(r||(r="string"),R[e]={type:r,defaultValue:t,callback:o},n)for(var i=0; i<n.length; i++)R[n[i]]=R[e];t&&B(e,t)}function B(e, t, r, n){var o=R[e],i=(n=n||{}).scope;if(!o)return new Error("Unknown option: "+e);if("boolean"==o.type){if(t&&!0!==t)return new Error("Invalid argument: "+e+"="+t);!1!==t&&(t=!0)}o.callback?("local"!==i&&o.callback(t,void 0),"global"!==i&&r&&o.callback(t,r)):("local"!==i&&(o.value="boolean"==o.type?!!t:t),"global"!==i&&r&&(r.state.vim.options[e]={value:t}))}function E(e, t, r){var n=R[e],o=(r=r||{}).scope;if(!n)return new Error("Unknown option: "+e);if(n.callback){var i=t&&n.callback(void 0,t);return"global"!==o&&void 0!==i?i:"local"!==o?n.callback():void 0}return((i="global"!==o&&t&&t.state.vim.options[e])||"local"!==o&&n||{}).value}T("filetype",void 0,"string",["ft"],function(e, t){if(void 0!==t){if(void 0===e)return"null"==(r=t.getOption("mode"))?"":r;var r=""==e?"null":e;t.setOption("mode",r)}});var I,O,P=function(){var e=100,t=-1,r=0,n=0,o=new Array(e);function i(i, a){(t+=a)>r?t=r:t<n&&(t=n);var s=o[(e+t)%e];if(s&&!s.find()){var l,c=a>0?1:-1,u=i.getCursor();do{if((s=o[(e+(t+=c))%e])&&(l=s.find())&&!re(u,l))break}while(t<r&&t>n)}return s}return{cachedCursor:void 0,add:function(i, a, s){var l=o[t%e];function c(r){var n=++t%e,a=o[n];a&&a.clear(),o[n]=i.setBookmark(r)}if(l){var u=l.find();u&&!re(u,a)&&c(a)}else c(a);c(s),r=t,(n=t-e+1)<0&&(n=0)},find:function(e, r){var n=t,o=i(e,r);return t=n,o&&o.find()},move:i}},K=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function N(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=K()}function F(e){return e.state.vim||(e.state.vim={inputState:new W,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),e.state.vim}function D(){for(var e in I={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:P(),macroModeState:new N,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new _({}),searchHistoryController:new V,exCommandHistoryController:new V},R){var t=R[e];t.value=t.defaultValue}}N.prototype={exitMacroRecordMode:function(){var e=I.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e, t){var r=I.registerController.getRegister(t);r&&(r.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog(document.createTextNode("(recording)["+t+"]"),null,{bottom:!0})),this.isRecording=!0)}};var U={buildKeyMap:function(){},getRegisterController:function(){return I.registerController},resetVimGlobalState_:D,getVimGlobalState_:function(){return I},maybeInitVimState_:F,suppressErrorLogging:!1,InsertModeKey:et,map:function(e, t, r){Qe.map(e,t,r)},unmap:function(e, t){return Qe.unmap(e,t)},noremap:function(e, t, r){function i(e){return e?[e]:["normal","insert","visual"]}for(var a=i(r),s=n.length,l=s-o; l<s&&a.length; l++){var c=n[l];if(!(c.keys!=t||r&&c.context&&c.context!==r||"ex"===c.type.substr(0,2)||"key"===c.type.substr(0,3))){var u={};for(var f in c)u[f]=c[f];u.keys=e,r&&!u.context&&(u.context=r),this._mapCommand(u);var d=i(c.context);a=a.filter(function(e){return-1===d.indexOf(e)})}}},mapclear:function(e){var t=n.length,r=o,i=n.slice(0,t-r);if(n=n.slice(t-r),e)for(var a=i.length-1; a>=0; a--){var s=i[a];if(e!==s.context)if(s.context)this._mapCommand(s);else{var l=["normal","insert","visual"];for(var c in l)if(l[c]!==e){var u={};for(var f in s)u[f]=s[f];u.context=l[c],this._mapCommand(u)}}}},setOption:B,getOption:E,defineOption:T,defineEx:function(e, t, r){if(t){if(0!==e.indexOf(t))throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;Je[e]=r,Qe.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e, t, r){var n=this.findKey(e,t,r);if("function"==typeof n)return n()},findKey:function(e, t, r){var o,i=F(e);function a(){var n=I.macroModeState;if(n.isRecording){if("q"==t)return n.exitMacroRecordMode(),H(e),!0;"mapping"!=r&&function(e, t){if(!e.isPlaying){var r=e.latestRegister,n=I.registerController.getRegister(r);n&&n.pushText(t)}}(n,t)}}function s(){if("<Esc>"==t)return H(e),i.visualMode?me(e):i.insertMode&&ze(e),!0}return!1===(o=i.insertMode?function(){if(s())return!0;for(var r=i.inputState.keyBuffer=i.inputState.keyBuffer+t,o=1==t.length,a=$.matchCommand(r,n,i.inputState,"insert"); r.length>1&&"full"!=a.type;){r=i.inputState.keyBuffer=r.slice(1);var l=$.matchCommand(r,n,i.inputState,"insert");"none"!=l.type&&(a=l)}if("none"==a.type)return H(e),!1;if("partial"==a.type)return O&&window.clearTimeout(O),O=window.setTimeout(function(){i.insertMode&&i.inputState.keyBuffer&&H(e)},E("insertModeEscKeysTimeout")),!o;if(O&&window.clearTimeout(O),o){for(var c=e.listSelections(),u=0; u<c.length; u++){var f=c[u].head;e.replaceRange("",Y(f,0,-(r.length-1)),f,"+input")}I.macroModeState.lastInsertModeChanges.changes.pop()}return H(e),a.command}():function(){if(a()||s())return!0;var r=i.inputState.keyBuffer=i.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(r))return!0;if(!(c=/^(\d*)(.*)$/.exec(r)))return H(e),!1;var o=i.visualMode?"visual":"normal",l=c[2]||c[1];i.inputState.operatorShortcut&&i.inputState.operatorShortcut.slice(-1)==l&&(l=i.inputState.operatorShortcut);var c,u=$.matchCommand(l,n,i.inputState,o);return"none"==u.type?(H(e),!1):"partial"==u.type||(i.inputState.keyBuffer="",(c=/^(\d*)(.*)$/.exec(r))[1]&&"0"!=c[1]&&i.inputState.pushRepeatDigit(c[1]),u.command)}())?i.insertMode||1!==t.length?void 0:function(){return!0}:!0===o?function(){return!0}:function(){return e.operation(function(){e.curOp.isVimOp=!0;try{"keyToKey"==o.type?function(r){for(var n; r;)n=/<\w+-.+?>|<\w+>|./.exec(r),t=n[0],r=r.substring(n.index+t.length),U.handleKey(e,t,"mapping")}(o.toKeys):$.processCommand(e,i,o)}catch(t){throw e.state.vim=void 0,F(e),U.suppressErrorLogging||console.log(t),t}return!0})}},handleEx:function(e, t){Qe.processCommand(e,t)},defineMotion:function(e, t){q[e]=t},defineAction:function(e, t){z[e]=t},defineOperator:function(e, t){Q[e]=t},mapCommand:function(e, t, r, n, o){var i={keys:e,type:t};for(var a in i[t]=r,i[t+"Args"]=n,o)i[a]=o[a];Xe(i)},_mapCommand:Xe,defineRegister:function(e, t){var r=I.registerController.registers;if(!e||1!=e.length)throw Error("Register name must be 1 character");if(r[e])throw Error("Register already defined "+e);r[e]=t,w.push(e)},exitVisualMode:me,exitInsertMode:ze};function W(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function H(t, r){t.state.vim.inputState=new W,e.signal(t,"vim-command-done",r)}function j(e, t, r){this.clear(),this.keyBuffer=[e||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!t,this.blockwise=!!r}function _(e){this.registers=e,this.unnamedRegister=e['"']=new j,e["."]=new j,e[":"]=new j,e["/"]=new j}function V(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}W.prototype.pushRepeatDigit=function(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)},W.prototype.getRepeat=function(){var e=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(e=1,this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))),e},j.prototype={setText:function(e, t, r){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!r},pushText:function(e, t){t&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(K(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},_.prototype={pushText:function(e, t, r, n, o){if("_"!==e){n&&"\n"!==r.charAt(r.length-1)&&(r+="\n");var i=this.isValidRegister(e)?this.getRegister(e):null;if(i)A(e)?i.pushText(r,n):i.setText(r,n,o),this.unnamedRegister.setText(i.toString(),n);else{switch(t){case"yank":this.registers[0]=new j(r,n,o);break;case"delete":case"change":-1==r.indexOf("\n")?this.registers["-"]=new j(r,n):(this.shiftNumericRegisters_(),this.registers[1]=new j(r,n))}this.unnamedRegister.setText(r,n,o)}}},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new j),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&M(e,w)},shiftNumericRegisters_:function(){for(var e=9; e>=2; e--)this.registers[e]=this.getRegister(""+(e-1))}},V.prototype={nextMatch:function(e, t){var r=this.historyBuffer,n=t?-1:1;null===this.initialPrefix&&(this.initialPrefix=e);for(var o=this.iterator+n; t?o>=0:o<r.length; o+=n)for(var i=r[o],a=0; a<=i.length; a++)if(this.initialPrefix==i.substring(0,a))return this.iterator=o,i;return o>=r.length?(this.iterator=r.length,this.initialPrefix):o<0?e:void 0},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var $={matchCommand:function(e, t, r, n){var o,i=function(e, t, r, n){for(var o,i=[],a=[],s=0; s<t.length; s++){var l=t[s];"insert"==r&&"insert"!=l.context||l.context&&l.context!=r||n.operator&&"action"==l.type||!(o=Z(e,l.keys))||("partial"==o&&i.push(l),"full"==o&&a.push(l))}return{partial:i.length&&i,full:a.length&&a}}(e,t,n,r);if(!i.full&&!i.partial)return{type:"none"};if(!i.full&&i.partial)return{type:"partial"};for(var a=0; a<i.full.length; a++){var s=i.full[a];o||(o=s)}if("<character>"==o.keys.slice(-11)){var l=function(e){var t=/^.*(<[^>]+>)$/.exec(e),r=t?t[1]:e.slice(-1);if(r.length>1)switch(r){case"<CR>":r="\n";break;case"<Space>":r=" ";break;default:r=""}return r}(e);if(!l)return{type:"none"};r.selectedCharacter=l}return{type:"full",command:o}},processCommand:function(e, t, r){switch(t.inputState.repeatOverride=r.repeatOverride,r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r)}},processMotion:function(e, t, r){t.inputState.motion=r.motion,t.inputState.motionArgs=G(r.motionArgs),this.evalInput(e,t)},processOperator:function(e, t, r){var n=t.inputState;if(n.operator){if(n.operator==r.operator)return n.motion="expandToLine",n.motionArgs={linewise:!0},void this.evalInput(e,t);H(e)}n.operator=r.operator,n.operatorArgs=G(r.operatorArgs),r.keys.length>1&&(n.operatorShortcut=r.keys),r.exitVisualBlock&&(t.visualBlock=!1,he(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e, t, r){var n=t.visualMode,o=G(r.operatorMotionArgs);o&&n&&o.visualLine&&(t.visualLine=!0),this.processOperator(e,t,r),n||this.processMotion(e,t,r)},processAction:function(e, t, r){var n=t.inputState,o=n.getRepeat(),i=!!o,a=G(r.actionArgs)||{};n.selectedCharacter&&(a.selectedCharacter=n.selectedCharacter),r.operator&&this.processOperator(e,t,r),r.motion&&this.processMotion(e,t,r),(r.motion||r.operator)&&this.evalInput(e,t),a.repeat=o||1,a.repeatIsExplicit=i,a.registerName=n.registerName,H(e),t.lastMotion=null,r.isEdit&&this.recordLastEdit(t,n,r),z[r.action](e,a,t)},processSearch:function(t, r, n){if(t.getSearchCursor){var o=n.searchArgs.forward,i=n.searchArgs.wholeWordOnly;Te(t).setReversed(!o);var a=o?"/":"?",s=Te(t).getQuery(),l=t.getScrollInfo();switch(n.searchArgs.querySrc){case"prompt":var c=I.macroModeState;c.isPlaying?h(d=c.replaySearchQueries.shift(),!0,!1):Fe(t,{onClose:function(e){t.scrollTo(l.left,l.top),h(e,!0,!0);var r=I.macroModeState;r.isRecording&&function(e, t){if(!e.isPlaying){var r=e.latestRegister,n=I.registerController.getRegister(r);n&&n.pushSearchQuery&&n.pushSearchQuery(t)}}(r,e)},prefix:a,desc:"(JavaScript regexp)",onKeyUp:function(r, n, i){var a,s,c,u=e.keyName(r);"Up"==u||"Down"==u?(a="Up"==u,s=r.target?r.target.selectionEnd:0,i(n=I.searchHistoryController.nextMatch(n,a)||""),s&&r.target&&(r.target.selectionEnd=r.target.selectionStart=Math.min(s,r.target.value.length))):"Left"!=u&&"Right"!=u&&"Ctrl"!=u&&"Alt"!=u&&"Shift"!=u&&I.searchHistoryController.reset();try{c=De(t,n,!0,!0)}catch(r){}c?t.scrollIntoView(He(t,!o,c),30):(je(t),t.scrollTo(l.left,l.top))},onKeyDown:function(r, n, o){var i=e.keyName(r);"Esc"==i||"Ctrl-C"==i||"Ctrl-["==i||"Backspace"==i&&""==n?(I.searchHistoryController.pushInput(n),I.searchHistoryController.reset(),De(t,s),je(t),t.scrollTo(l.left,l.top),e.e_stop(r),H(t),o(),t.focus()):"Up"==i||"Down"==i?e.e_stop(r):"Ctrl-U"==i&&(e.e_stop(r),o(""))}});break;case"wordUnderCursor":var u=ve(t,!1,0,!1,!0),f=!0;if(u||(u=ve(t,!1,0,!1,!1),f=!1),!u)return;var d=t.getLine(u.start.line).substring(u.start.ch,u.end.ch);d=f&&i?"\\b"+d+"\\b":d.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),I.jumpList.cachedCursor=t.getCursor(),t.setCursor(u.start),h(d,!0,!1)}}function h(e, o, i){I.searchHistoryController.pushInput(e),I.searchHistoryController.reset();try{De(t,e,o,i)}catch(r){return Ne(t,"Invalid regex: "+e),void H(t)}$.processMotion(t,r,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:n.searchArgs.toJumplist}})}},processEx:function(t, r, n){function o(e){I.exCommandHistoryController.pushInput(e),I.exCommandHistoryController.reset(),Qe.processCommand(t,e)}function i(r, n, o){var i,a,s=e.keyName(r);("Esc"==s||"Ctrl-C"==s||"Ctrl-["==s||"Backspace"==s&&""==n)&&(I.exCommandHistoryController.pushInput(n),I.exCommandHistoryController.reset(),e.e_stop(r),H(t),o(),t.focus()),"Up"==s||"Down"==s?(e.e_stop(r),i="Up"==s,a=r.target?r.target.selectionEnd:0,o(n=I.exCommandHistoryController.nextMatch(n,i)||""),a&&r.target&&(r.target.selectionEnd=r.target.selectionStart=Math.min(a,r.target.value.length))):"Ctrl-U"==s?(e.e_stop(r),o("")):"Left"!=s&&"Right"!=s&&"Ctrl"!=s&&"Alt"!=s&&"Shift"!=s&&I.exCommandHistoryController.reset()}"keyToEx"==n.type?Qe.processCommand(t,n.exArgs.input):r.visualMode?Fe(t,{onClose:o,prefix:":",value:"'<,'>",onKeyDown:i,selectValueOnOpen:!1}):Fe(t,{onClose:o,prefix:":",onKeyDown:i})},evalInput:function(e, r){var n,o,i,a=r.inputState,s=a.motion,l=a.motionArgs||{},c=a.operator,u=a.operatorArgs||{},f=a.registerName,d=r.sel,h=te(r.visualMode?X(e,d.head):e.getCursor("head")),p=te(r.visualMode?X(e,d.anchor):e.getCursor("anchor")),m=te(h),g=te(p);if(c&&this.recordLastEdit(r,a),(i=void 0!==a.repeatOverride?a.repeatOverride:a.getRepeat())>0&&l.explicitRepeat?l.repeatIsExplicit=!0:(l.noRepeat||!l.explicitRepeat&&0===i)&&(i=1,l.repeatIsExplicit=!1),a.selectedCharacter&&(l.selectedCharacter=u.selectedCharacter=a.selectedCharacter),l.repeat=i,H(e),s){var v=q[s](e,h,l,r,a);if(r.lastMotion=q[s],!v)return;if(l.toJumplist){var y=I.jumpList,C=y.cachedCursor;C?(ye(e,C,v),delete y.cachedCursor):ye(e,h,v)}v instanceof Array?(o=v[0],n=v[1]):n=v,n||(n=te(h)),r.visualMode?(r.visualBlock&&n.ch===1/0||(n=X(e,n)),o&&(o=X(e,o)),o=o||g,d.anchor=o,d.head=n,he(e),Le(e,r,"<",ne(o,n)?o:n),Le(e,r,">",ne(o,n)?n:o)):c||(n=X(e,n),e.setCursor(n.line,n.ch))}if(c){if(u.lastSel){o=g;var k=u.lastSel,w=Math.abs(k.head.line-k.anchor.line),S=Math.abs(k.head.ch-k.anchor.ch);n=k.visualLine?new t(g.line+w,g.ch):k.visualBlock?new t(g.line+w,g.ch+S):k.head.line==k.anchor.line?new t(g.line,g.ch+S):new t(g.line+w,g.ch),r.visualMode=!0,r.visualLine=k.visualLine,r.visualBlock=k.visualBlock,d=r.sel={anchor:o,head:n},he(e)}else r.visualMode&&(u.lastSel={anchor:te(d.anchor),head:te(d.head),visualBlock:r.visualBlock,visualLine:r.visualLine});var x,A,b,M,R;if(r.visualMode){if(x=oe(d.head,d.anchor),A=ie(d.head,d.anchor),b=r.visualLine||u.linewise,R=pe(e,{anchor:x,head:A},M=r.visualBlock?"block":b?"line":"char"),b){var T=R.ranges;if("block"==M)for(var B=0; B<T.length; B++)T[B].head.ch=se(e,T[B].head.line);else"line"==M&&(T[0].head=new t(T[0].head.line+1,0))}}else{if(x=te(o||g),ne(A=te(n||m),x)){var E=x;x=A,A=E}(b=l.linewise||u.linewise)?function(e, t, r){t.ch=0,r.ch=0,r.line++}(0,x,A):l.forward&&function(e, t, r){var n=e.getRange(t,r);if(/\n\s*$/.test(n)){var o=n.split("\n");o.pop();for(var i=o.pop(); o.length>0&&i&&L(i); i=o.pop())r.line--,r.ch=0;i?(r.line--,r.ch=se(e,r.line)):r.ch=0}}(e,x,A),R=pe(e,{anchor:x,head:A},M="char",!l.inclusive||b)}e.setSelections(R.ranges,R.primary),r.lastMotion=null,u.repeat=i,u.registerName=f,u.linewise=b;var O=Q[c](e,u,R.ranges,g,n);r.visualMode&&me(e,null!=O),O&&e.setCursor(O)}},recordLastEdit:function(e, t, r){var n=I.macroModeState;n.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,n.lastInsertModeChanges.changes=[],n.lastInsertModeChanges.expectCursorActivityForChange=!1,n.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},q={moveToTopLine:function(e, r, n){var o=_e(e).top+n.repeat-1;return new t(o,ge(e.getLine(o)))},moveToMiddleLine:function(e){var r=_e(e),n=Math.floor(.5*(r.top+r.bottom));return new t(n,ge(e.getLine(n)))},moveToBottomLine:function(e, r, n){var o=_e(e).bottom-n.repeat+1;return new t(o,ge(e.getLine(o)))},expandToLine:function(e, r, n){return new t(r.line+n.repeat-1,1/0)},findNext:function(e, t, r){var n=Te(e),o=n.getQuery();if(o){var i=!r.forward;return i=n.isReversed()?!i:i,We(e,o),He(e,i,o,r.repeat)}},findAndSelectNextInclusive:function(r, n, o, i, a){var s=Te(r),l=s.getQuery();if(l){var c=!o.forward,u=function(e, r, n, o, i){return void 0===o&&(o=1),e.operation(function(){var a=e.getCursor(),s=e.getSearchCursor(n,a),l=s.find(!r);!i.visualMode&&l&&re(s.from(),a)&&s.find(!r);for(var c=0; c<o; c++)if(!(l=s.find(r))&&!(s=e.getSearchCursor(n,r?new t(e.lastLine()):new t(e.firstLine(),0))).find(r))return;return[s.from(),s.to()]})}(r,c=s.isReversed()?!c:c,l,o.repeat,i);if(u){if(a.operator)return u;var f=u[0],d=new t(u[1].line,u[1].ch-1);if(i.visualMode){(i.visualLine||i.visualBlock)&&(i.visualLine=!1,i.visualBlock=!1,e.signal(r,"vim-mode-change",{mode:"visual",subMode:""}));var h=i.sel.anchor;if(h)return s.isReversed()?o.forward?[h,f]:[h,d]:o.forward?[h,d]:[h,f]}else i.visualMode=!0,i.visualLine=!1,i.visualBlock=!1,e.signal(r,"vim-mode-change",{mode:"visual",subMode:""});return c?[d,f]:[f,d]}}},goToMark:function(e, t, r, n){var o=Ve(e,n,r.selectedCharacter);return o?r.linewise?{line:o.line,ch:ge(e.getLine(o.line))}:o:null},moveToOtherHighlightedEnd:function(e, r, n, o){if(o.visualBlock&&n.sameLine){var i=o.sel;return[X(e,new t(i.anchor.line,i.head.ch)),X(e,new t(i.head.line,i.anchor.ch))]}return[o.sel.head,o.sel.anchor]},jumpToMark:function(e, r, n, o){for(var i=r,a=0; a<n.repeat; a++){var s=i;for(var l in o.marks)if(x(l)){var c=o.marks[l].find();if(!((n.forward?ne(c,s):ne(s,c))||n.linewise&&c.line==s.line)){var u=re(s,i),f=n.forward?ae(s,c,i):ae(i,c,s);(u||f)&&(i=c)}}}return n.linewise&&(i=new t(i.line,ge(e.getLine(i.line)))),i},moveByCharacters:function(e, r, n){var o=r,i=n.repeat,a=n.forward?o.ch+i:o.ch-i;return new t(o.line,a)},moveByLines:function(e, r, n, o){var i=r,a=i.ch;switch(o.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=o.lastHPos;break;default:o.lastHPos=a}var s=n.repeat+(n.repeatOffset||0),l=n.forward?i.line+s:i.line-s,c=e.firstLine(),u=e.lastLine(),f=e.findPosV(i,n.forward?s:-s,"line",o.lastHSPos);return(n.forward?f.line>l:f.line<l)&&(l=f.line,a=f.ch),l<c&&i.line==c?this.moveToStartOfLine(e,r,n,o):l>u&&i.line==u?xe(e,r,n,o,!0):(n.toFirstChar&&(a=ge(e.getLine(l)),o.lastHPos=a),o.lastHSPos=e.charCoords(new t(l,a),"div").left,new t(l,a))},moveByDisplayLines:function(e, r, n, o){var i=r;switch(o.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:o.lastHSPos=e.charCoords(i,"div").left}var a=n.repeat;if((l=e.findPosV(i,n.forward?a:-a,"line",o.lastHSPos)).hitSide)if(n.forward)var s={top:e.charCoords(l,"div").top+8,left:o.lastHSPos},l=e.coordsChar(s,"div");else{var c=e.charCoords(new t(e.firstLine(),0),"div");c.left=o.lastHSPos,l=e.coordsChar(c,"div")}return o.lastHPos=l.ch,l},moveByPage:function(e, t, r){var n=t,o=r.repeat;return e.findPosV(n,r.forward?o:-o,"page")},moveByParagraph:function(e, t, r){var n=r.forward?1:-1;return Me(e,t,r.repeat,n)},moveBySentence:function(e, r, n){var o=n.forward?1:-1;return function(e, r, n, o){function i(e, t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){if(t.ln+=t.dir,!S(e,t.ln))return t.line=null,t.ln=null,void(t.pos=null);t.line=e.getLine(t.ln),t.pos=t.dir>0?0:t.line.length-1}else t.pos+=t.dir}function a(e, t, r, n){var o=e.getLine(t),a=""===o,s={line:o,ln:t,pos:r,dir:n},l={ln:s.ln,pos:s.pos},c=""===s.line;for(i(e,s); null!==s.line;){if(l.ln=s.ln,l.pos=s.pos,""===s.line&&!c)return{ln:s.ln,pos:s.pos};if(a&&""!==s.line&&!L(s.line[s.pos]))return{ln:s.ln,pos:s.pos};!b(s.line[s.pos])||a||s.pos!==s.line.length-1&&!L(s.line[s.pos+1])||(a=!0),i(e,s)}var o=e.getLine(l.ln);l.pos=0;for(var u=o.length-1; u>=0; --u)if(!L(o[u])){l.pos=u;break}return l}function s(e, t, r, n){var o=e.getLine(t),a={line:o,ln:t,pos:r,dir:n},s={ln:a.ln,pos:null},l=""===a.line;for(i(e,a); null!==a.line;){if(""===a.line&&!l)return null!==s.pos?s:{ln:a.ln,pos:a.pos};if(b(a.line[a.pos])&&null!==s.pos&&(a.ln!==s.ln||a.pos+1!==s.pos))return s;""===a.line||L(a.line[a.pos])||(l=!1,s={ln:a.ln,pos:a.pos}),i(e,a)}var o=e.getLine(s.ln);s.pos=0;for(var c=0; c<o.length; ++c)if(!L(o[c])){s.pos=c;break}return s}for(var l={ln:r.line,pos:r.ch}; n>0;)l=o<0?s(e,l.ln,l.pos,o):a(e,l.ln,l.pos,o),n--;return new t(l.ln,l.pos)}(e,r,n.repeat,o)},moveByScroll:function(e, t, r, n){var o=e.getScrollInfo(),i=null,a=r.repeat;a||(a=o.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");if(r.repeat=a,!(i=q.moveByDisplayLines(e,t,r,n)))return null;var l=e.charCoords(i,"local");return e.scrollTo(null,o.top+l.top-s.top),i},moveByWords:function(e, r, n){return function(e, r, n, o, i, a){var s=te(r),l=[];(o&&!i||!o&&i)&&n++;for(var c=!(o&&i),u=0; u<n; u++){var f=Se(e,r,o,a,c);if(!f){var d=se(e,e.lastLine());l.push(o?{line:e.lastLine(),from:d,to:d}:{line:0,from:0,to:0});break}l.push(f),r=new t(f.line,o?f.to-1:f.from)}var h=l.length!=n,p=l[0],m=l.pop();return o&&!i?(h||p.from==s.ch&&p.line==s.line||(m=l.pop()),new t(m.line,m.from)):o&&i?new t(m.line,m.to-1):!o&&i?(h||p.to==s.ch&&p.line==s.line||(m=l.pop()),new t(m.line,m.to)):new t(m.line,m.from)}(e,r,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(e, t, r){var n=Ae(e,r.repeat,r.forward,r.selectedCharacter),o=r.forward?-1:1;return Ce(o,r),n?(n.ch+=o,n):null},moveToCharacter:function(e, t, r){var n=r.repeat;return Ce(0,r),Ae(e,n,r.forward,r.selectedCharacter)||t},moveToSymbol:function(e, r, n){return function(e, r, n, o){var i=te(e.getCursor()),a=n?1:-1,s=n?e.lineCount():-1,l=i.ch,c=i.line,u=e.getLine(c),f={lineText:u,nextCh:u.charAt(l),lastCh:null,index:l,symb:o,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[o],forward:n,depth:0,curMoveThrough:!1},d=ke[o];if(!d)return i;var h=we[d].init,p=we[d].isComplete;for(h&&h(f); c!==s&&r;){if(f.index+=a,f.nextCh=f.lineText.charAt(f.index),!f.nextCh){if(c+=a,f.lineText=e.getLine(c)||"",a>0)f.index=0;else{var m=f.lineText.length;f.index=m>0?m-1:0}f.nextCh=f.lineText.charAt(f.index)}p(f)&&(i.line=c,i.ch=f.index,r--)}return f.nextCh||f.curMoveThrough?new t(c,f.index):i}(e,n.repeat,n.forward,n.selectedCharacter)||r},moveToColumn:function(e, r, n, o){var i=n.repeat;return o.lastHPos=i-1,o.lastHSPos=e.charCoords(r,"div").left,function(e, r){var n=e.getCursor().line;return X(e,new t(n,r-1))}(e,i)},moveToEol:function(e, t, r, n){return xe(e,t,r,n,!1)},moveToFirstNonWhiteSpaceCharacter:function(e, r){var n=r;return new t(n.line,ge(e.getLine(n.line)))},moveToMatchedSymbol:function(e, r){for(var n,o=r,i=o.line,a=o.ch,s=e.getLine(i); a<s.length; a++)if((n=s.charAt(a))&&-1!="()[]{}".indexOf(n)){var l=e.getTokenTypeAt(new t(i,a+1));if("string"!==l&&"comment"!==l)break}if(a<s.length){var c="<"===a||">"===a?/[(){}[\]<>]/:/[(){}[\]]/;return e.findMatchingBracket(new t(i,a),{bracketRegex:c}).to}return o},moveToStartOfLine:function(e, r){return new t(r.line,0)},moveToLineOrEdgeOfDocument:function(e, r, n){var o=n.forward?e.lastLine():e.firstLine();return n.repeatIsExplicit&&(o=n.repeat-e.getOption("firstLineNumber")),new t(o,ge(e.getLine(o)))},textObjectManipulation:function(r, n, o, i){var a=o.selectedCharacter;"b"==a?a="(":"B"==a&&(a="{");var s,l=!o.textObjectInner;if({"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"}[a])s=function(e, r, n, o){var i,a,s=r,l={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n],c={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[n],u=e.getLine(s.line).charAt(s.ch)===c?1:0;if(i=e.scanForBracket(new t(s.line,s.ch+u),-1,void 0,{bracketRegex:l}),a=e.scanForBracket(new t(s.line,s.ch+u),1,void 0,{bracketRegex:l}),!i||!a)return{start:s,end:s};if(i=i.pos,a=a.pos,i.line==a.line&&i.ch>a.ch||i.line>a.line){var f=i;i=a,a=f}return o?a.ch+=1:i.ch+=1,{start:i,end:a}}(r,n,a,l);else if({"'":!0,'"':!0,"`":!0}[a])s=function(e, r, n, o){var i,a,s,l,c=te(r),u=e.getLine(c.line).split(""),f=u.indexOf(n);if(c.ch<f?c.ch=f:f<c.ch&&u[c.ch]==n&&(a=c.ch,--c.ch),u[c.ch]!=n||a)for(s=c.ch; s>-1&&!i; s--)u[s]==n&&(i=s+1);else i=c.ch+1;if(i&&!a)for(s=i,l=u.length; s<l&&!a; s++)u[s]==n&&(a=s);return i&&a?(o&&(--i,++a),{start:new t(c.line,i),end:new t(c.line,a)}):{start:c,end:c}}(r,n,a,l);else if("W"===a)s=ve(r,l,0,!0);else if("w"===a)s=ve(r,l,0,!1);else if("p"===a)if(s=Me(r,n,o.repeat,0,l),o.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var c=i.inputState.operatorArgs;c&&(c.linewise=!0),s.end.line--}else{if("t"!==a)return null;s=function(t, r, n){var o=r;if(!e.findMatchingTag||!e.findEnclosingTag)return{start:o,end:o};var i=e.findMatchingTag(t,r)||e.findEnclosingTag(t,r);return i&&i.open&&i.close?n?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}:{start:o,end:o}}(r,n,l)}return r.state.vim.visualMode?function(e, r, n){var o,i=e.state.vim.sel,a=i.head,s=i.anchor;return ne(n,r)&&(o=n,n=r,r=o),ne(a,s)?(a=oe(r,a),s=ie(s,n)):(s=oe(r,s),-1==(a=Y(a=ie(a,n),0,-1)).ch&&a.line!=e.firstLine()&&(a=new t(a.line-1,se(e,a.line-1)))),[s,a]}(r,s.start,s.end):[s.start,s.end]},repeatLastCharacterSearch:function(e, t, r){var n=I.lastCharacterSearch,o=r.repeat,i=r.forward===n.forward,a=(n.increment?1:0)*(i?-1:1);e.moveH(-a,"char"),r.inclusive=!!i;var s=Ae(e,o,i,n.selectedCharacter);return s?(s.ch+=a,s):(e.moveH(a,"char"),t)}};function J(e, t){for(var r=[],n=0; n<t; n++)r.push(e);return r}var Q={change:function(r, n, o){var i,a,s=r.state.vim,l=o[0].anchor,c=o[0].head;if(s.visualMode)if(n.fullLine)c.ch=Number.MAX_VALUE,c.line--,r.setSelection(l,c),a=r.getSelection(),r.replaceSelection(""),i=l;else{a=r.getSelection();var u=J("",o.length);r.replaceSelections(u),i=oe(o[0].head,o[0].anchor)}else{a=r.getRange(l,c);var f=s.lastEditInputState||{};if("moveByWords"==f.motion&&!L(a)){var d=/\s+$/.exec(a);d&&f.motionArgs&&f.motionArgs.forward&&(c=Y(c,0,-d[0].length),a=a.slice(0,-d[0].length))}var h=new t(l.line-1,Number.MAX_VALUE),p=r.firstLine()==r.lastLine();c.line>r.lastLine()&&n.linewise&&!p?r.replaceRange("",h,c):r.replaceRange("",l,c),n.linewise&&(p||(r.setCursor(h),e.commands.newlineAndIndent(r)),l.ch=Number.MAX_VALUE),i=l}I.registerController.pushText(n.registerName,"change",a,n.linewise,o.length>1),z.enterInsertMode(r,{head:i},r.state.vim)},delete:function(e, r, n){var o,i,a=e.state.vim;if(a.visualBlock){i=e.getSelection();var s=J("",n.length);e.replaceSelections(s),o=oe(n[0].head,n[0].anchor)}else{var l=n[0].anchor,c=n[0].head;r.linewise&&c.line!=e.firstLine()&&l.line==e.lastLine()&&l.line==c.line-1&&(l.line==e.firstLine()?l.ch=0:l=new t(l.line-1,se(e,l.line-1))),i=e.getRange(l,c),e.replaceRange("",l,c),o=l,r.linewise&&(o=q.moveToFirstNonWhiteSpaceCharacter(e,l))}return I.registerController.pushText(r.registerName,"delete",i,r.linewise,a.visualBlock),X(e,o)},indent:function(e, t, r){var n=e.state.vim,o=r[0].anchor.line,i=n.visualBlock?r[r.length-1].anchor.line:r[0].head.line,a=n.visualMode?t.repeat:1;t.linewise&&i--;for(var s=o; s<=i; s++)for(var l=0; l<a; l++)e.indentLine(s,t.indentRight);return q.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e, t, r){return e.execCommand("indentAuto"),q.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},changeCase:function(e, t, r, n, o){for(var i=e.getSelections(),a=[],s=t.toLower,l=0; l<i.length; l++){var c=i[l],u="";if(!0===s)u=c.toLowerCase();else if(!1===s)u=c.toUpperCase();else for(var f=0; f<c.length; f++){var d=c.charAt(f);u+=A(d)?d.toLowerCase():d.toUpperCase()}a.push(u)}return e.replaceSelections(a),t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?q.moveToFirstNonWhiteSpaceCharacter(e,n):t.linewise?n:oe(r[0].anchor,r[0].head)},yank:function(e, t, r, n){var o=e.state.vim,i=e.getSelection(),a=o.visualMode?oe(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):n;return I.registerController.pushText(t.registerName,"yank",i,t.linewise,o.visualBlock),a}};var z={jumpListWalk:function(e, t, r){if(!r.visualMode){var n=t.repeat,o=t.forward,i=I.jumpList.move(e,o?n:-n),a=i?i.find():void 0;a=a||e.getCursor(),e.setCursor(a)}},scroll:function(e, t, r){if(!r.visualMode){var n=t.repeat||1,o=e.defaultTextHeight(),i=e.getScrollInfo().top,a=o*n,s=t.forward?i+a:i-a,l=te(e.getCursor()),c=e.charCoords(l,"local");if(t.forward)s>c.top?(l.line+=(s-c.top)/o,l.line=Math.ceil(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,s);else{var u=s+e.getScrollInfo().clientHeight;u<c.bottom?(l.line-=(c.bottom-u)/o,l.line=Math.floor(l.line),e.setCursor(l),c=e.charCoords(l,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,s)}}},scrollToCursor:function(e, r){var n=e.getCursor().line,o=e.charCoords(new t(n,0),"local"),i=e.getScrollInfo().clientHeight,a=o.top,s=o.bottom-a;switch(r.position){case"center":a=a-i/2+s;break;case"bottom":a=a-i+s}e.scrollTo(null,a)},replayMacro:function(e, t, r){var n=t.selectedCharacter,o=t.repeat,i=I.macroModeState;for("@"==n?n=i.latestRegister:i.latestRegister=n; o--;)Ge(e,r,i,n)},enterMacroRecordMode:function(e, t){var r=I.macroModeState,n=t.selectedCharacter;I.registerController.isValidRegister(n)&&r.enterMacroRecordMode(e,n)},toggleOverwrite:function(t){t.state.overwrite?(t.toggleOverwrite(!1),t.setOption("keyMap","vim-insert"),e.signal(t,"vim-mode-change",{mode:"insert"})):(t.toggleOverwrite(!0),t.setOption("keyMap","vim-replace"),e.signal(t,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(r, n, o){if(!r.getOption("readOnly")){o.insertMode=!0,o.insertModeRepeat=n&&n.repeat||1;var i=n?n.insertAt:null,a=o.sel,s=n.head||r.getCursor("head"),l=r.listSelections().length;if("eol"==i)s=new t(s.line,se(r,s.line));else if("bol"==i)s=new t(s.line,0);else if("charAfter"==i)s=Y(s,0,1);else if("firstNonBlank"==i)s=q.moveToFirstNonWhiteSpaceCharacter(r,s);else if("startOfSelectedArea"==i){if(!o.visualMode)return;o.visualBlock?(s=new t(Math.min(a.head.line,a.anchor.line),Math.min(a.head.ch,a.anchor.ch)),l=Math.abs(a.head.line-a.anchor.line)+1):s=a.head.line<a.anchor.line?a.head:new t(a.anchor.line,0)}else if("endOfSelectedArea"==i){if(!o.visualMode)return;o.visualBlock?(s=new t(Math.min(a.head.line,a.anchor.line),Math.max(a.head.ch,a.anchor.ch)+1),l=Math.abs(a.head.line-a.anchor.line)+1):s=a.head.line>=a.anchor.line?Y(a.head,0,1):new t(a.anchor.line,0)}else if("inplace"==i){if(o.visualMode)return}else"lastEdit"==i&&(s=$e(r)||s);r.setOption("disableInput",!1),n&&n.replace?(r.toggleOverwrite(!0),r.setOption("keyMap","vim-replace"),e.signal(r,"vim-mode-change",{mode:"replace"})):(r.toggleOverwrite(!1),r.setOption("keyMap","vim-insert"),e.signal(r,"vim-mode-change",{mode:"insert"})),I.macroModeState.isPlaying||(r.on("change",Ye),e.on(r.getInputField(),"keydown",tt)),o.visualMode&&me(r),fe(r,s,l)}},toggleVisualMode:function(r, n, o){var i,a=n.repeat,s=r.getCursor();o.visualMode?o.visualLine^n.linewise||o.visualBlock^n.blockwise?(o.visualLine=!!n.linewise,o.visualBlock=!!n.blockwise,e.signal(r,"vim-mode-change",{mode:"visual",subMode:o.visualLine?"linewise":o.visualBlock?"blockwise":""}),he(r)):me(r):(o.visualMode=!0,o.visualLine=!!n.linewise,o.visualBlock=!!n.blockwise,i=X(r,new t(s.line,s.ch+a-1)),o.sel={anchor:s,head:i},e.signal(r,"vim-mode-change",{mode:"visual",subMode:o.visualLine?"linewise":o.visualBlock?"blockwise":""}),he(r),Le(r,o,"<",oe(s,i)),Le(r,o,">",ie(s,i)))},reselectLastSelection:function(t, r, n){var o=n.lastSelection;if(n.visualMode&&de(t,n),o){var i=o.anchorMark.find(),a=o.headMark.find();if(!i||!a)return;n.sel={anchor:i,head:a},n.visualMode=!0,n.visualLine=o.visualLine,n.visualBlock=o.visualBlock,he(t),Le(t,n,"<",oe(i,a)),Le(t,n,">",ie(i,a)),e.signal(t,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(e, r, n){var o,i;if(n.visualMode){if(o=e.getCursor("anchor"),ne(i=e.getCursor("head"),o)){var a=i;i=o,o=a}i.ch=se(e,i.line)-1}else{var s=Math.max(r.repeat,2);o=e.getCursor(),i=X(e,new t(o.line+s-1,1/0))}for(var l=0,c=o.line; c<i.line; c++){l=se(e,o.line),a=new t(o.line+1,se(e,o.line+1));var u=e.getRange(o,a);u=r.keepSpaces?u.replace(/\n\r?/g,""):u.replace(/\n\s*/g," "),e.replaceRange(u,o,a)}var f=new t(o.line,l);n.visualMode&&me(e,!1),e.setCursor(f)},newLineAndEnterInsertMode:function(r, n, o){o.insertMode=!0;var i=te(r.getCursor());i.line!==r.firstLine()||n.after?(i.line=n.after?i.line:i.line-1,i.ch=se(r,i.line),r.setCursor(i),(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(r)):(r.replaceRange("\n",new t(r.firstLine(),0)),r.setCursor(r.firstLine(),0)),this.enterInsertMode(r,{repeat:n.repeat},o)},paste:function(e, r, n){var o=te(e.getCursor()),i=I.registerController.getRegister(r.registerName);if(h=i.toString()){if(r.matchIndent){var a=e.getOption("tabSize"),s=function(e){var t=e.split("\t").length-1,r=e.split(" ").length-1;return t*a+1*r},l=e.getLine(e.getCursor().line),c=s(l.match(/^\s*/)[0]),u=h.replace(/\n$/,""),f=h!==u,d=s(h.match(/^\s*/)[0]),h=u.replace(/^\s*/gm,function(t){var r=c+(s(t)-d);if(r<0)return"";if(e.getOption("indentWithTabs")){var n=Math.floor(r/a);return Array(n+1).join("\t")}return Array(r+1).join(" ")});h+=f?"\n":""}r.repeat>1&&(h=Array(r.repeat+1).join(h));var p,m,g=i.linewise,v=i.blockwise;if(v){h=h.split("\n"),g&&h.pop();for(var y=0; y<h.length; y++)h[y]=""==h[y]?" ":h[y];o.ch+=r.after?1:0,o.ch=Math.min(se(e,o.line),o.ch)}else g?n.visualMode?h=n.visualLine?h.slice(0,-1):"\n"+h.slice(0,h.length-1)+"\n":r.after?(h="\n"+h.slice(0,h.length-1),o.ch=se(e,o.line)):o.ch=0:o.ch+=r.after?1:0;if(n.visualMode){var C;n.lastPastedText=h;var k=function(e, r){var n,o,i,a,s,l=r.lastSelection;return r.visualMode?(n=e.listSelections(),o=n[0],i=n[n.length-1],a=ne(o.anchor,o.head)?o.anchor:o.head,s=ne(i.anchor,i.head)?i.head:i.anchor,[a,s]):function(){var r=e.getCursor(),n=e.getCursor(),o=l.visualBlock;if(o){var i=o.width,a=o.height;n=new t(r.line+a,r.ch+i);for(var s=[],c=r.line; c<n.line; c++){var u=new t(c,r.ch),f=new t(c,n.ch),d={anchor:u,head:f};s.push(d)}e.setSelections(s)}else{var h=l.anchorMark.find(),p=l.headMark.find(),m=p.line-h.line,g=p.ch-h.ch;n={line:n.line+m,ch:m?n.ch:g+n.ch},l.visualLine&&(r=new t(r.line,0),n=new t(n.line,se(e,n.line))),e.setSelection(r,n)}return[r,n]}()}(e,n),w=k[0],S=k[1],x=e.getSelection(),A=e.listSelections(),L=new Array(A.length).join("1").split("1");n.lastSelection&&(C=n.lastSelection.headMark.find()),I.registerController.unnamedRegister.setText(x),v?(e.replaceSelections(L),S=new t(w.line+h.length-1,w.ch),e.setCursor(w),ue(e,S),e.replaceSelections(h),p=w):n.visualBlock?(e.replaceSelections(L),e.setCursor(w),e.replaceRange(h,w,w),p=w):(e.replaceRange(h,w,S),p=e.posFromIndex(e.indexFromPos(w)+h.length-1)),C&&(n.lastSelection.headMark=e.setBookmark(C)),g&&(p.ch=0)}else if(v){for(e.setCursor(o),y=0; y<h.length; y++){var b=o.line+y;b>e.lastLine()&&e.replaceRange("\n",new t(b,0)),se(e,b)<o.ch&&ce(e,b,o.ch)}e.setCursor(o),ue(e,new t(o.line+h.length-1,o.ch)),e.replaceSelections(h),p=o}else e.replaceRange(h,o),g&&r.after?p=new t(o.line+1,ge(e.getLine(o.line+1))):g&&!r.after?p=new t(o.line,ge(e.getLine(o.line))):!g&&r.after?(m=e.indexFromPos(o),p=e.posFromIndex(m+h.length-1)):(m=e.indexFromPos(o),p=e.posFromIndex(m+h.length));n.visualMode&&me(e,!1),e.setCursor(p)}},undo:function(t, r){t.operation(function(){ee(t,e.commands.undo,r.repeat)(),t.setCursor(t.getCursor("anchor"))})},redo:function(t, r){ee(t,e.commands.redo,r.repeat)()},setRegister:function(e, t, r){r.inputState.registerName=t.selectedCharacter},setMark:function(e, t, r){Le(e,r,t.selectedCharacter,e.getCursor())},replace:function(r, n, o){var i,a,s=n.selectedCharacter,l=r.getCursor(),c=r.listSelections();if(o.visualMode)l=r.getCursor("start"),a=r.getCursor("end");else{var u=r.getLine(l.line);(i=l.ch+n.repeat)>u.length&&(i=u.length),a=new t(l.line,i)}if("\n"==s)o.visualMode||r.replaceRange("",l,a),(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(r);else{var f=r.getRange(l,a);if(f=f.replace(/[^\n]/g,s),o.visualBlock){var d=new Array(r.getOption("tabSize")+1).join(" ");f=(f=r.getSelection()).replace(/\t/g,d).replace(/[^\n]/g,s).split("\n"),r.replaceSelections(f)}else r.replaceRange(f,l,a);o.visualMode?(l=ne(c[0].anchor,c[0].head)?c[0].anchor:c[0].head,r.setCursor(l),me(r,!1)):r.setCursor(Y(a,0,-1))}},incrementNumberToken:function(e, r){for(var n,o,i,a,s=e.getCursor(),l=e.getLine(s.line),c=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi; null!==(n=c.exec(l))&&(i=(o=n.index)+n[0].length,!(s.ch<i)););if((r.backtrack||!(i<=s.ch))&&n){var u=n[2]||n[4],f=n[3]||n[5],d=r.increase?1:-1,h={"0b":2,0:8,"":10,"0x":16}[u.toLowerCase()];a=(parseInt(n[1]+f,h)+d*r.repeat).toString(h);var p=u?new Array(f.length-a.length+1+n[1].length).join("0"):"";a="-"===a.charAt(0)?"-"+u+p+a.substr(1):u+p+a;var m=new t(s.line,o),g=new t(s.line,i);e.replaceRange(a,m,g),e.setCursor(new t(s.line,o+a.length-1))}},repeatLastEdit:function(e, t, r){if(r.lastEditInputState){var n=t.repeat;n&&t.repeatIsExplicit?r.lastEditInputState.repeatOverride=n:n=r.lastEditInputState.repeatOverride||n,rt(e,r,n,!1)}},indent:function(e, t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:ze};function X(e, r){var n=e.state.vim,o=n.insertMode||n.visualMode,i=Math.min(Math.max(e.firstLine(),r.line),e.lastLine()),a=se(e,i)-1+!!o,s=Math.min(Math.max(0,r.ch),a);return new t(i,s)}function G(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function Y(e, r, n){return"object"==typeof r&&(n=r.ch,r=r.line),new t(e.line+r,e.ch+n)}function Z(e, t){if("<character>"==t.slice(-11)){var r=t.length-11,n=e.slice(0,r),o=t.slice(0,r);return n==o&&e.length>r?"full":0==o.indexOf(n)&&"partial"}return e==t?"full":0==t.indexOf(e)&&"partial"}function ee(e, t, r){return function(){for(var n=0; n<r; n++)t(e)}}function te(e){return new t(e.line,e.ch)}function re(e, t){return e.ch==t.ch&&e.line==t.line}function ne(e, t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function oe(e, t){return arguments.length>2&&(t=oe.apply(void 0,Array.prototype.slice.call(arguments,1))),ne(e,t)?e:t}function ie(e, t){return arguments.length>2&&(t=ie.apply(void 0,Array.prototype.slice.call(arguments,1))),ne(e,t)?t:e}function ae(e, t, r){var n=ne(e,t),o=ne(t,r);return n&&o}function se(e, t){return e.getLine(t).length}function le(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ce(e, r, n){var o=se(e,r),i=new Array(n-o+1).join(" ");e.setCursor(new t(r,o)),e.replaceRange(i,e.getCursor())}function ue(e, r){var n=[],o=e.listSelections(),i=te(e.clipPos(r)),a=!re(r,i),s=function(e, t, r){for(var n=0; n<e.length; n++){var o="head"!=r&&re(e[n].anchor,t),i="anchor"!=r&&re(e[n].head,t);if(o||i)return n}return-1}(o,e.getCursor("head")),l=re(o[s].head,o[s].anchor),c=o.length-1,u=c-s>s?c:0,f=o[u].anchor,d=Math.min(f.line,i.line),h=Math.max(f.line,i.line),p=f.ch,m=i.ch,g=o[u].head.ch-p,v=m-p;g>0&&v<=0?(p++,a||m--):g<0&&v>=0?(p--,l||m++):g<0&&-1==v&&(p--,m++);for(var y=d; y<=h; y++){var C={anchor:new t(y,p),head:new t(y,m)};n.push(C)}return e.setSelections(n),r.ch=m,f.ch=p,f}function fe(e, t, r){for(var n=[],o=0; o<r; o++){var i=Y(t,o,0);n.push({anchor:i,head:i})}e.setSelections(n,0)}function de(e, t){var r=t.sel.anchor,n=t.sel.head;t.lastPastedText&&(n=e.posFromIndex(e.indexFromPos(r)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(r),headMark:e.setBookmark(n),anchor:te(r),head:te(n),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function he(e, t, r){var n=e.state.vim,o=pe(e,t=t||n.sel,r=r||n.visualLine?"line":n.visualBlock?"block":"char");e.setSelections(o.ranges,o.primary)}function pe(e, r, n, o){var i=te(r.head),a=te(r.anchor);if("char"==n){var s=o||ne(r.head,r.anchor)?0:1,l=ne(r.head,r.anchor)?1:0;return i=Y(r.head,0,s),{ranges:[{anchor:a=Y(r.anchor,0,l),head:i}],primary:0}}if("line"==n){if(ne(r.head,r.anchor))i.ch=0,a.ch=se(e,a.line);else{a.ch=0;var c=e.lastLine();i.line>c&&(i.line=c),i.ch=se(e,i.line)}return{ranges:[{anchor:a,head:i}],primary:0}}if("block"==n){var u=Math.min(a.line,i.line),f=a.ch,d=Math.max(a.line,i.line),h=i.ch;f<h?h+=1:f+=1;for(var p=d-u+1,m=i.line==u?0:p-1,g=[],v=0; v<p; v++)g.push({anchor:new t(u+v,f),head:new t(u+v,h)});return{ranges:g,primary:m}}}function me(t, r){var n=t.state.vim;!1!==r&&t.setCursor(X(t,n.sel.head)),de(t,n),n.visualMode=!1,n.visualLine=!1,n.visualBlock=!1,n.insertMode||e.signal(t,"vim-mode-change",{mode:"normal"})}function ge(e){if(!e)return 0;var t=e.search(/\S/);return-1==t?e.length:t}function ve(e, r, n, o, i){for(var a=function(e){var t=e.getCursor("head");return 1==e.getSelection().length&&(t=oe(t,e.getCursor("anchor"))),t}(e),s=e.getLine(a.line),l=a.ch,c=i?h[0]:p[0]; !c(s.charAt(l));)if(++l>=s.length)return null;o?c=p[0]:(c=h[0])(s.charAt(l))||(c=h[1]);for(var u=l,f=l; c(s.charAt(u))&&u<s.length;)u++;for(; c(s.charAt(f))&&f>=0;)f--;if(f++,r){for(var d=u; /\s/.test(s.charAt(u))&&u<s.length;)u++;if(d==u){for(var m=f; /\s/.test(s.charAt(f-1))&&f>0;)f--;f||(f=m)}}return{start:new t(a.line,f),end:new t(a.line,u)}}function ye(e, t, r){re(t,r)||I.jumpList.add(e,t,r)}function Ce(e, t){I.lastCharacterSearch.increment=e,I.lastCharacterSearch.forward=t.forward,I.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var ke={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},we={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return 0===e.index&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t="*"===e.lastCh&&"/"===e.nextCh;return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb="m"===e.symb?"{":"}",e.reverseSymb="{"===e.symb?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if("#"===e.nextCh){var t=e.lineText.match(/^#(\w+)/)[1];if("endif"===t){if(e.forward&&0===e.depth)return!0;e.depth++}else if("if"===t){if(!e.forward&&0===e.depth)return!0;e.depth--}if("else"===t&&0===e.depth)return!0}return!1}}};function Se(e, t, r, n, o){var i=t.line,a=t.ch,s=e.getLine(i),l=r?1:-1,c=n?p:h;if(o&&""==s){if(i+=l,s=e.getLine(i),!S(e,i))return null;a=r?0:s.length}for(;;){if(o&&""==s)return{from:0,to:0,line:i};for(var u=l>0?s.length:-1,f=u,d=u; a!=u;){for(var m=!1,g=0; g<c.length&&!m; ++g)if(c[g](s.charAt(a))){for(f=a; a!=u&&c[g](s.charAt(a));)a+=l;if(m=f!=(d=a),f==t.ch&&i==t.line&&d==f+l)continue;return{from:Math.min(f,d+1),to:Math.max(f,d),line:i}}m||(a+=l)}if(!S(e,i+=l))return null;s=e.getLine(i),a=l>0?0:s.length}}function xe(e, r, n, o, i){var a=new t(r.line+n.repeat-1,1/0),s=e.clipPos(a);return s.ch--,i||(o.lastHPos=1/0,o.lastHSPos=e.charCoords(s,"div").left),a}function Ae(e, r, n, o){for(var i,a=e.getCursor(),s=a.ch,l=0; l<r; l++){if(-1==(i=be(s,e.getLine(a.line),o,n,!0)))return null;s=i}return new t(e.getCursor().line,i)}function Le(e, t, r, n){M(r,k)&&(t.marks[r]&&t.marks[r].clear(),t.marks[r]=e.setBookmark(n))}function be(e, t, r, n, o){var i;return n?-1==(i=t.indexOf(r,e+1))||o||(i-=1):-1==(i=t.lastIndexOf(r,e-1))||o||(i+=1),i}function Me(e, r, n, o, i){var a,s=r.line,l=e.firstLine(),c=e.lastLine(),u=s;function f(t){return!e.getLine(t)}function d(e, t, r){return r?f(e)!=f(e+t):!f(e)&&f(e+t)}if(o){for(; l<=u&&u<=c&&n>0;)d(u,o)&&n--,u+=o;return new t(u,0)}var h=e.state.vim;if(h.visualLine&&d(s,1,!0)){var p=h.sel.anchor;d(p.line,-1,!0)&&(i&&p.line==s||(s+=1))}var m=f(s);for(u=s; u<=c&&n; u++)d(u,1,!0)&&(i&&f(u)==m||n--);for(a=new t(u,0),u>c&&!m?m=!0:i=!1,u=s; u>l&&(i&&f(u)!=m&&u!=s||!d(u,-1,!0)); u--);return{start:new t(u,0),end:a}}function Re(){}function Te(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new Re)}function Be(e, t){var r=Ee(e,t)||[];if(!r.length)return[];var n=[];if(0===r[0]){for(var o=0; o<r.length; o++)"number"==typeof r[o]&&n.push(e.substring(r[o]+1,r[o+1]));return n}}function Ee(e, t){t||(t="/");for(var r=!1,n=[],o=0; o<e.length; o++){var i=e.charAt(o);r||i!=t||n.push(o),r=!r&&"\\"==i}return n}T("pcre",!0,"boolean"),Re.prototype={getQuery:function(){return I.query},setQuery:function(e){I.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return I.isReversed},setReversed:function(e){I.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};var Ie={"\\n":"\n","\\r":"\r","\\t":"\t"};var Oe={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"};function Pe(e, t, r){if(I.registerController.getRegister("/").setText(e),e instanceof RegExp)return e;var n,o,i=Ee(e,"/");return i.length?(n=e.substring(0,i[0]),o=-1!=e.substring(i[0]).indexOf("i")):n=e,n?(E("pcre")||(n=function(e){for(var t=!1,r=[],n=-1; n<e.length; n++){var o=e.charAt(n)||"",i=e.charAt(n+1)||"",a=i&&-1!="|(){".indexOf(i);t?("\\"===o&&a||r.push(o),t=!1):"\\"===o?(t=!0,i&&-1!="}".indexOf(i)&&(a=!0),a&&"\\"!==i||r.push(o)):(r.push(o),a&&"\\"!==i&&r.push("\\"))}return r.join("")}(n)),r&&(t=/^[^A-Z]*$/.test(n)),new RegExp(n,t||o?"im":"m")):null}function Ke(e){"string"==typeof e&&(e=document.createElement(e));for(var t,r=1; r<arguments.length; r++)if(t=arguments[r])if("object"!=typeof t&&(t=document.createTextNode(t)),t.nodeType)e.appendChild(t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&("$"===n[0]?e.style[n.slice(1)]=t[n]:e.setAttribute(n,t[n]));return e}function Ne(e, t){var r=Ke("pre",{$color:"red",class:"cm-vim-message"},t);e.openNotification?e.openNotification(r,{bottom:!0,duration:5e3}):alert(r.innerText)}function Fe(e, t){var r,n,o=(r=t.prefix,n=t.desc,Ke(document.createDocumentFragment(),Ke("span",{$fontFamily:"monospace",$whiteSpace:"pre"},r,Ke("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),n&&Ke("span",{$color:"#888"},n)));if(e.openDialog)e.openDialog(o,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:t.value});else{var i="";"string"!=typeof t.prefix&&t.prefix&&(i+=t.prefix.textContent),t.desc&&(i+=" "+t.desc),t.onClose(prompt(i,""))}}function De(e, t, r, n){if(t){var o=Te(e),i=Pe(t,!!r,!!n);if(i)return We(e,i),function(e, t){if(e instanceof RegExp&&t instanceof RegExp){for(var r=["global","multiline","ignoreCase","source"],n=0; n<r.length; n++){var o=r[n];if(e[o]!==t[o])return!1}return!0}return!1}(i,o.getQuery())?i:(o.setQuery(i),i)}}var Ue=0;function We(e, t){clearTimeout(Ue),Ue=setTimeout(function(){if(e.state.vim){var r=Te(e),n=r.getOverlay();n&&t==n.query||(n&&e.removeOverlay(n),n=function(e){if("^"==e.source.charAt(0))var t=!0;return{token:function(r){if(!t||r.sol()){var n=r.match(e,!1);if(n)return 0==n[0].length?(r.next(),"searching"):r.sol()||(r.backUp(1),e.exec(r.next()+n[0]))?(r.match(e),"searching"):(r.next(),null);for(; !r.eol()&&(r.next(),!r.match(e,!1)););}else r.skipToEnd()},query:e}}(t),e.addOverlay(n),e.showMatchesOnScrollbar&&(r.getScrollbarAnnotate()&&r.getScrollbarAnnotate().clear(),r.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),r.setOverlay(n))}},50)}function He(e, r, n, o){return void 0===o&&(o=1),e.operation(function(){for(var i=e.getCursor(),a=e.getSearchCursor(n,i),s=0; s<o; s++){var l=a.find(r);if(0==s&&l&&re(a.from(),i)){var c=r?a.from():a.to();(l=a.find(r))&&!l[0]&&re(a.from(),c)&&e.getLine(c.line).length==c.ch&&(l=a.find(r))}if(!l&&!(a=e.getSearchCursor(n,r?new t(e.lastLine()):new t(e.firstLine(),0))).find(r))return}return a.from()})}function je(e){var t=Te(e);e.removeOverlay(Te(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function _e(e){var t=e.getScrollInfo(),r=e.coordsChar({left:0,top:6+t.top},"local"),n=t.clientHeight-10+t.top,o=e.coordsChar({left:0,top:n},"local");return{top:r.line,bottom:o.line}}function Ve(e, r, n){if("'"==n||"`"==n)return I.jumpList.find(e,-1)||new t(0,0);if("."==n)return $e(e);var o=r.marks[n];return o&&o.find()}function $e(e){for(var t=e.doc.history.done,r=t.length; r--;)if(t[r].changes)return te(t[r].changes[0].to)}var qe=function(){this.buildCommandMap_()};qe.prototype={processCommand:function(e, t, r){var n=this;e.operation(function(){e.curOp.isVimOp=!0,n._processCommand(e,t,r)})},_processCommand:function(t, r, n){var o=t.state.vim,i=I.registerController.getRegister(":"),a=i.toString();o.visualMode&&me(t);var s=new e.StringStream(r);i.setText(r);var l,c,u=n||{};u.input=r;try{this.parseInput_(t,s,u)}catch(e){throw Ne(t,e.toString()),e}if(u.commandName){if(l=this.matchCommand_(u.commandName)){if(c=l.name,l.excludeFromCommandHistory&&i.setText(a),this.parseCommandArgs_(s,u,l),"exToKey"==l.type){for(var f=0; f<l.toKeys.length; f++)U.handleKey(t,l.toKeys[f],"mapping");return}if("exToEx"==l.type)return void this.processCommand(t,l.toInput)}}else void 0!==u.line&&(c="move");if(c)try{Je[c](t,u),l&&l.possiblyAsync||!u.callback||u.callback()}catch(e){throw Ne(t,e.toString()),e}else Ne(t,'Not an editor command ":'+r+'"')},parseInput_:function(e, t, r){t.eatWhile(":"),t.eat("%")?(r.line=e.firstLine(),r.lineEnd=e.lastLine()):(r.line=this.parseLineSpec_(e,t),void 0!==r.line&&t.eat(",")&&(r.lineEnd=this.parseLineSpec_(e,t)));var n=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return r.commandName=n?n[1]:t.match(/.*/)[0],r},parseLineSpec_:function(e, t){var r=t.match(/^(\d+)/);if(r)return parseInt(r[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var n=t.next(),o=Ve(e,e.state.vim,n);if(!o)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:return void t.backUp(1)}},parseLineSpecOffset_:function(e, t){var r=e.match(/^([+-])?(\d+)/);if(r){var n=parseInt(r[2],10);"-"==r[1]?t-=n:t+=n}return t},parseCommandArgs_:function(e, t, r){if(!e.eol()){t.argString=e.match(/.*/)[0];var n=r.argDelimiter||/\s+/,o=le(t.argString).split(n);o.length&&o[0]&&(t.args=o)}},matchCommand_:function(e){for(var t=e.length; t>0; t--){var r=e.substring(0,t);if(this.commandMap_[r]){var n=this.commandMap_[r];if(0===n.name.indexOf(e))return n}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0; e<i.length; e++){var t=i[e],r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e, t, r){if(":"!=e&&":"==e.charAt(0)){if(r)throw Error("Mode not supported for ex mappings");var o=e.substring(1);":"!=t&&":"==t.charAt(0)?this.commandMap_[o]={name:o,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[o]={name:o,type:"exToKey",toKeys:t,user:!0}}else if(":"!=t&&":"==t.charAt(0)){var i={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};r&&(i.context=r),n.unshift(i)}else i={keys:e,type:"keyToKey",toKeys:t},r&&(i.context=r),n.unshift(i)},unmap:function(e, t){if(":"!=e&&":"==e.charAt(0)){if(t)throw Error("Mode not supported for ex mappings");var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user)return delete this.commandMap_[r],!0}else for(var o=e,i=0; i<n.length; i++)if(o==n[i].keys&&n[i].context===t)return n.splice(i,1),!0}};var Je={colorscheme:function(e, t){!t.args||t.args.length<1?Ne(e,e.getOption("theme")):e.setOption("theme",t.args[0])},map:function(e, t, r){var n=t.args;!n||n.length<2?e&&Ne(e,"Invalid mapping: "+t.input):Qe.map(n[0],n[1],r)},imap:function(e, t){this.map(e,t,"insert")},nmap:function(e, t){this.map(e,t,"normal")},vmap:function(e, t){this.map(e,t,"visual")},unmap:function(e, t, r){var n=t.args;(!n||n.length<1||!Qe.unmap(n[0],r))&&e&&Ne(e,"No such mapping: "+t.input)},move:function(e, t){$.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e, t){var r=t.args,n=t.setCfg||{};if(!r||r.length<1)e&&Ne(e,"Invalid mapping: "+t.input);else{var o=r[0].split("="),i=o[0],a=o[1],s=!1;if("?"==i.charAt(i.length-1)){if(a)throw Error("Trailing characters: "+t.argString);i=i.substring(0,i.length-1),s=!0}void 0===a&&"no"==i.substring(0,2)&&(i=i.substring(2),a=!1);var l=R[i]&&"boolean"==R[i].type;if(l&&null==a&&(a=!0),!l&&void 0===a||s){var c=E(i,e,n);c instanceof Error?Ne(e,c.message):Ne(e,!0===c||!1===c?" "+(c?"":"no")+i:"  "+i+"="+c)}else{var u=B(i,a,e,n);u instanceof Error&&Ne(e,u.message)}}},setlocal:function(e, t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e, t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e, t){var r=t.args,n=I.registerController.registers,o="----------Registers----------\n\n";if(r){r=r.join("");for(var i=0; i<r.length; i++)a=r.charAt(i),I.registerController.isValidRegister(a)&&(o+='"'+a+"    "+(n[a]||new j).toString()+"\n")}else for(var a in n){var s=n[a].toString();s.length&&(o+='"'+a+"    "+s+"\n")}Ne(e,o)},sort:function(r, n){var o,i,a,s,l,c=function(){if(n.argString){var t=new e.StringStream(n.argString);if(t.eat("!")&&(o=!0),t.eol())return;if(!t.eatSpace())return"Invalid arguments";var r=t.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!r&&!t.eol())return"Invalid arguments";if(r[1]){i=-1!=r[1].indexOf("i"),a=-1!=r[1].indexOf("u");var c=-1!=r[1].indexOf("d")||-1!=r[1].indexOf("n")&&1,u=-1!=r[1].indexOf("x")&&1,f=-1!=r[1].indexOf("o")&&1;if(c+u+f>1)return"Invalid arguments";s=(c?"decimal":u&&"hex")||f&&"octal"}r[2]&&(l=new RegExp(r[2].substr(1,r[2].length-2),i?"i":""))}}();if(c)Ne(r,c+": "+n.argString);else{var u=n.line||r.firstLine(),f=n.lineEnd||n.line||r.lastLine();if(u!=f){var d=new t(u,0),h=new t(f,se(r,f)),p=r.getRange(d,h).split("\n"),m=l||("decimal"==s?/(-?)([\d]+)/:"hex"==s?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==s?/([0-7]+)/:null),g="decimal"==s?10:"hex"==s?16:"octal"==s?8:null,v=[],y=[];if(s||l)for(var C=0; C<p.length; C++){var k=l?p[C].match(l):null;k&&""!=k[0]?v.push(k):!l&&m.exec(p[C])?v.push(p[C]):y.push(p[C])}else y=p;if(v.sort(l?function(e, t){var r;return o&&(r=e,e=t,t=r),i&&(e[0]=e[0].toLowerCase(),t[0]=t[0].toLowerCase()),e[0]<t[0]?-1:1}:x),l)for(C=0; C<v.length; C++)v[C]=v[C].input;else s||y.sort(x);if(p=o?v.concat(y):y.concat(v),a){var w,S=p;for(p=[],C=0; C<S.length; C++)S[C]!=w&&p.push(S[C]),w=S[C]}r.replaceRange(p.join("\n"),d,h)}}function x(e, t){var r;o&&(r=e,e=t,t=r),i&&(e=e.toLowerCase(),t=t.toLowerCase());var n=s&&m.exec(e),a=s&&m.exec(t);return n?(n=parseInt((n[1]+n[2]).toLowerCase(),g))-(a=parseInt((a[1]+a[2]).toLowerCase(),g)):e<t?-1:1}},vglobal:function(e, t){this.global(e,t)},global:function(e, t){var r=t.argString;if(r){var n,o="v"===t.commandName[0],i=void 0!==t.line?t.line:e.firstLine(),a=t.lineEnd||t.line||e.lastLine(),s=function(e){return Be(e,"/")}(r),l=r;if(s.length&&(l=s[0],n=s.slice(1,s.length).join("/")),l)try{De(e,l,!0,!0)}catch(t){return void Ne(e,"Invalid regex: "+l)}for(var c=Te(e).getQuery(),u=[],f=i; f<=a; f++){var d=e.getLineHandle(f);c.test(d.text)!==o&&u.push(n?d:d.text)}if(n){var h=0,p=function(){if(h<u.length){var t=u[h++],r=e.getLineNumber(t);if(null==r)return void p();var o=r+1+n;Qe.processCommand(e,o,{callback:p})}};p()}else Ne(e,u.join("\n"))}else Ne(e,"Regular Expression missing from global")},substitute:function(r, n){if(!r.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var o,i,a,s,l=n.argString,c=l?Be(l,l[0]):[],u="",f=!1,h=!1;if(c.length)o=c[0],E("pcre")&&""!==o&&(o=new RegExp(o).source),void 0!==(u=c[1])&&(u=E("pcre")?function(t){for(var r=new e.StringStream(t),n=[]; !r.eol();){for(; r.peek()&&"\\"!=r.peek();)n.push(r.next());var o=!1;for(var i in Oe)if(r.match(i,!0)){o=!0,n.push(Oe[i]);break}o||n.push(r.next())}return n.join("")}(u.replace(/([^\\])&/g,"$1$$&")):function(e){for(var t,r=!1,n=[],o=-1; o<e.length; o++){var i=e.charAt(o)||"",a=e.charAt(o+1)||"";Ie[i+a]?(n.push(Ie[i+a]),o++):r?(n.push(i),r=!1):"\\"===i?(r=!0,t=a,d.test(t)||"$"===a?n.push("$"):"/"!==a&&"\\"!==a&&n.push("\\")):("$"===i&&n.push("$"),n.push(i),"/"===a&&n.push("\\"))}return n.join("")}(u),I.lastSubstituteReplacePart=u),i=c[2]?c[2].split(" "):[];else if(l&&l.length)return void Ne(r,"Substitutions should be of the form :s/pattern/replace/");if(i&&(a=i[0],s=parseInt(i[1]),a&&(-1!=a.indexOf("c")&&(f=!0),-1!=a.indexOf("g")&&(h=!0),o=E("pcre")?o+"/"+a:o.replace(/\//g,"\\/")+"/"+a)),o)try{De(r,o,!0,!0)}catch(e){return void Ne(r,"Invalid regex: "+o)}if(void 0!==(u=u||I.lastSubstituteReplacePart)){var p=Te(r).getQuery(),m=void 0!==n.line?n.line:r.getCursor().line,g=n.lineEnd||m;m==r.firstLine()&&g==r.lastLine()&&(g=1/0),s&&(g=(m=g)+s-1);var v=X(r,new t(m,0)),y=r.getSearchCursor(p,v);!function(t, r, n, o, i, a, s, l, c){t.state.vim.exMode=!0;var u,f,d,h=!1;function p(){t.operation(function(){for(; !h;)m(),v();y()})}function m(){var e=t.getRange(a.from(),a.to()),r=e.replace(s,l),n=a.to().line;a.replace(r),f=a.to().line,i+=f-n,d=f<n}function g(){var e=u&&te(a.to()),t=a.findNext();return t&&!t[0]&&e&&re(a.from(),e)&&(t=a.findNext()),t}function v(){for(; g()&&(e=a.from(),r=o,s=i,"number"!=typeof e&&(e=e.line),r instanceof Array?M(e,r):"number"==typeof s?e>=r&&e<=s:e==r);)if(n||a.from().line!=f||d)return t.scrollIntoView(a.from(),30),t.setSelection(a.from(),a.to()),u=a.from(),void(h=!1);var e,r,s;h=!0}function y(e){if(e&&e(),t.focus(),u){t.setCursor(u);var r=t.state.vim;r.exMode=!1,r.lastHPos=r.lastHSPos=u.ch}c&&c()}if(v(),!h)return r?void Fe(t,{prefix:Ke("span","replace with ",Ke("strong",l)," (y/n/a/q/l)"),onKeyDown:function(r, n, o){switch(e.e_stop(r),e.keyName(r)){case"Y":m(),v();break;case"N":v();break;case"A":var i=c;c=void 0,t.operation(p),c=i;break;case"L":m();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":y(o)}return h&&y(o),!0}}):(p(),void(c&&c()));Ne(t,"No matches for "+s.source)}(r,f,h,m,g,y,p,u,n.callback)}else Ne(r,"No previous substitute regular expression")},redo:e.commands.redo,undo:e.commands.undo,write:function(t){e.commands.save?e.commands.save(t):t.save&&t.save()},nohlsearch:function(e){je(e)},yank:function(e){var t=te(e.getCursor()).line,r=e.getLine(t);I.registerController.pushText("0","yank",r,!0,!0)},delmarks:function(t, r){if(r.argString&&le(r.argString))for(var n=t.state.vim,o=new e.StringStream(le(r.argString)); !o.eol();){o.eatSpace();var i=o.pos;if(!o.match(/[a-zA-Z]/,!1))return void Ne(t,"Invalid argument: "+r.argString.substring(i));var a=o.next();if(o.match("-",!0)){if(!o.match(/[a-zA-Z]/,!1))return void Ne(t,"Invalid argument: "+r.argString.substring(i));var s=a,l=o.next();if(!(x(s)&&x(l)||A(s)&&A(l)))return void Ne(t,"Invalid argument: "+s+"-");var c=s.charCodeAt(0),u=l.charCodeAt(0);if(c>=u)return void Ne(t,"Invalid argument: "+r.argString.substring(i));for(var f=0; f<=u-c; f++){var d=String.fromCharCode(c+f);delete n.marks[d]}}else delete n.marks[a]}else Ne(t,"Argument required")}},Qe=new qe;function ze(t){var r=t.state.vim,n=I.macroModeState,o=I.registerController.getRegister("."),i=n.isPlaying,a=n.lastInsertModeChanges;i||(t.off("change",Ye),e.off(t.getInputField(),"keydown",tt)),!i&&r.insertModeRepeat>1&&(rt(t,r,r.insertModeRepeat-1,!0),r.lastEditInputState.repeatOverride=r.insertModeRepeat),delete r.insertModeRepeat,r.insertMode=!1,t.setCursor(t.getCursor().line,t.getCursor().ch-1),t.setOption("keyMap","vim"),t.setOption("disableInput",!0),t.toggleOverwrite(!1),o.setText(a.changes.join("")),e.signal(t,"vim-mode-change",{mode:"normal"}),n.isRecording&&function(e){if(!e.isPlaying){var t=e.latestRegister,r=I.registerController.getRegister(t);r&&r.pushInsertModeChanges&&r.pushInsertModeChanges(e.lastInsertModeChanges)}}(n)}function Xe(e){n.unshift(e)}function Ge(e, t, r, n){var o=I.registerController.getRegister(n);if(":"==n)return o.keyBuffer[0]&&Qe.processCommand(e,o.keyBuffer[0]),void(r.isPlaying=!1);var i=o.keyBuffer,a=0;r.isPlaying=!0,r.replaySearchQueries=o.searchQueries.slice(0);for(var s=0; s<i.length; s++)for(var l,c,u=i[s]; u;)if(c=(l=/<\w+-.+?>|<\w+>|./.exec(u))[0],u=u.substring(l.index+c.length),U.handleKey(e,c,"macro"),t.insertMode){var f=o.insertModeChanges[a++].changes;I.macroModeState.lastInsertModeChanges.changes=f,nt(e,f,1),ze(e)}r.isPlaying=!1}function Ye(e, t){var r=I.macroModeState,n=r.lastInsertModeChanges;if(!r.isPlaying)for(; t;){if(n.expectCursorActivityForChange=!0,n.ignoreCount>1)n.ignoreCount--;else if("+input"==t.origin||"paste"==t.origin||void 0===t.origin){var o=e.listSelections().length;o>1&&(n.ignoreCount=o);var i=t.text.join("\n");n.maybeReset&&(n.changes=[],n.maybeReset=!1),i&&(e.state.overwrite&&!/\n/.test(i)?n.changes.push([i]):n.changes.push(i))}t=t.next}}function Ze(t){var r=t.state.vim;if(r.insertMode){var n=I.macroModeState;if(n.isPlaying)return;var o=n.lastInsertModeChanges;o.expectCursorActivityForChange?o.expectCursorActivityForChange=!1:o.maybeReset=!0}else t.curOp.isVimOp||function(t, r){var n=t.getCursor("anchor"),o=t.getCursor("head");if(r.visualMode&&!t.somethingSelected()?me(t,!1):r.visualMode||r.insertMode||!t.somethingSelected()||(r.visualMode=!0,r.visualLine=!1,e.signal(t,"vim-mode-change",{mode:"visual"})),r.visualMode){var i=ne(o,n)?0:-1,a=ne(o,n)?-1:0;o=Y(o,0,i),n=Y(n,0,a),r.sel={anchor:n,head:o},Le(t,r,"<",oe(o,n)),Le(t,r,">",ie(o,n))}else r.insertMode||(r.lastHPos=t.getCursor().ch)}(t,r)}function et(e){this.keyName=e}function tt(t){var r=I.macroModeState.lastInsertModeChanges,n=e.keyName(t);n&&(-1==n.indexOf("Delete")&&-1==n.indexOf("Backspace")||e.lookupKey(n,"vim-insert",function(){return r.maybeReset&&(r.changes=[],r.maybeReset=!1),r.changes.push(new et(n)),!0}))}function rt(e, t, r, n){var o=I.macroModeState;o.isPlaying=!0;var i=!!t.lastEditActionCommand,a=t.inputState;function s(){i?$.processAction(e,t,t.lastEditActionCommand):$.evalInput(e,t)}function l(r){if(o.lastInsertModeChanges.changes.length>0){r=t.lastEditActionCommand?r:1;var n=o.lastInsertModeChanges;nt(e,n.changes,r)}}if(t.inputState=t.lastEditInputState,i&&t.lastEditActionCommand.interlaceInsertRepeat)for(var c=0; c<r; c++)s(),l(1);else n||s(),l(r);t.inputState=a,t.insertMode&&!n&&ze(e),o.isPlaying=!1}function nt(t, r, n){function o(r){return"string"==typeof r?e.commands[r](t):r(t),!0}var i=t.getCursor("head"),a=I.macroModeState.lastInsertModeChanges.visualBlock;a&&(fe(t,i,a+1),n=t.listSelections().length,t.setCursor(i));for(var s=0; s<n; s++){a&&t.setCursor(Y(i,s,0));for(var l=0; l<r.length; l++){var c=r[l];if(c instanceof et)e.lookupKey(c.keyName,"vim-insert",o);else if("string"==typeof c)t.replaceSelection(c);else{var u=t.getCursor(),f=Y(u,0,c[0].length);t.replaceRange(c[0],u,f),t.setCursor(f)}}}a&&t.setCursor(Y(i,0,1))}return e.keyMap.vim={attach:s,detach:a,call:l},T("insertModeEscKeysTimeout",200,"number"),e.keyMap["vim-insert"]={fallthrough:["default"],attach:s,detach:a,call:l},e.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:s,detach:a,call:l},D(),U}()});